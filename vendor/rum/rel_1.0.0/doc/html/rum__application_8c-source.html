<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>RUM: rum_src/rum_application.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>rum_src/rum_application.c</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Copyright (c) 2008  ATMEL Corporation</span>
<a name="l00002"></a>00002 <span class="comment">   All rights reserved.</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">   Redistribution and use in source and binary forms, with or without</span>
<a name="l00005"></a>00005 <span class="comment">   modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">   * Redistributions of source code must retain the above copyright</span>
<a name="l00008"></a>00008 <span class="comment">     notice, this list of conditions and the following disclaimer.</span>
<a name="l00009"></a>00009 <span class="comment">   * Redistributions in binary form must reproduce the above copyright</span>
<a name="l00010"></a>00010 <span class="comment">     notice, this list of conditions and the following disclaimer in</span>
<a name="l00011"></a>00011 <span class="comment">     the documentation and/or other materials provided with the</span>
<a name="l00012"></a>00012 <span class="comment">     distribution.</span>
<a name="l00013"></a>00013 <span class="comment">   * Neither the name of the copyright holders nor the names of</span>
<a name="l00014"></a>00014 <span class="comment">     contributors may be used to endorse or promote products derived</span>
<a name="l00015"></a>00015 <span class="comment">     from this software without specific prior written permission.</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"</span>
<a name="l00018"></a>00018 <span class="comment">  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="l00019"></a>00019 <span class="comment">  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="l00020"></a>00020 <span class="comment">  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
<a name="l00021"></a>00021 <span class="comment">  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<a name="l00022"></a>00022 <span class="comment">  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<a name="l00023"></a>00023 <span class="comment">  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<a name="l00024"></a>00024 <span class="comment">  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<a name="l00025"></a>00025 <span class="comment">  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<a name="l00026"></a>00026 <span class="comment">  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<a name="l00027"></a>00027 <span class="comment">  POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00028"></a>00028 <span class="comment">*/</span>
<a name="l00029"></a>00029 <span class="comment">/*</span>
<a name="l00030"></a>00030 <span class="comment">  $Id: rum_application.c,v 1.5 2009/05/28 22:42:00 bleverett Exp $</span>
<a name="l00031"></a>00031 <span class="comment">*/</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;stddef.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include "radio.h"</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include "timer.h"</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include "mac.h"</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include "mac_event.h"</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include "mac_start.h"</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include "mac_data.h"</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include "mac_scan.h"</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include "mac_associate.h"</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include "system.h"</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include "hal.h"</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include "sleep.h"</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include "sensors.h"</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include "sixlowpan_wake.h"</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#if __arm__</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="comment">// Utasker include</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include "config.h"</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="preprocessor">#include "tuip.h"</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include "hal_arm.h"</span>
<a name="l00057"></a>00057 <span class="preprocessor">#define sixlowpan_hc01_gen_rs()</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span><span class="preprocessor">#define sixlowpan_init()</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span><span class="preprocessor">#define sixlowpan_application_init()</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">#define serial_send_frame(a,b,c)</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="comment">//QUEUE_HANDLE  current_interface_handle;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#else // AVR</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span><span class="preprocessor">    #include "serial.h"</span>
<a name="l00064"></a>00064 <span class="preprocessor">    #define tuip_init_802154(a, b)</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>    <span class="comment">//#include &lt;avr/eeprom.h&gt;</span>
<a name="l00066"></a>00066     <span class="comment">// You can program the EEPROM with macaddress this way, using an ELF file</span>
<a name="l00067"></a>00067     <span class="comment">//u8 EEMEM macaddress[8] = {0xde, 0xed, 0xbe, 0xef, 0x11, 0x22, 0x33, 0x44};</span>
<a name="l00068"></a>00068     <span class="comment">//u8 EEMEM macaddress[8] = {0x01, 0x23, 0x45, 0x56, 0x78, 0x9a, 0xbc, 0xde};</span>
<a name="l00069"></a>00069     <span class="comment">//u8 EEMEM macaddress[8] = {0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff};</span>
<a name="l00070"></a>00070 <span class="preprocessor">        #include "avr_sixlowpan.h"</span>
<a name="l00071"></a>00071 <span class="preprocessor">        #if (IPV6LOWPAN == 0)</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">            #define sixlowpan_hc01_gen_rs(a)</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor">        #endif</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span>    <span class="keywordtype">void</span> <a class="code" href="group__avr6lowpan__example.html#g31a4ca6d7db7f9ec030631ec2251fba2" title="Initilize the 6lowpan application.">sixlowpan_application_init</a>(<span class="keywordtype">void</span>);
<a name="l00075"></a>00075     <span class="keyword">static</span> u8 pingTimer;
<a name="l00076"></a>00076     <span class="keyword">static</span> u8 streamMode=0;        
<a name="l00077"></a>00077     <span class="keyword">extern</span> tSerialFrame SerialFrame[];
<a name="l00078"></a>00078 <span class="preprocessor">#endif</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span><span class="preprocessor">#define UDP_PORT_COMMANDS 0xF0B0</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span><span class="preprocessor">#define UDP_PORT_RESPONSE 0xF0B1</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span>
<a name="l00082"></a>00082 <span class="keyword">extern</span> u8 simulateButton;
<a name="l00083"></a>00083 <span class="keyword">extern</span> u16 <a class="code" href="group__sensors.html#g8b30ebe0133dac95776ec6431d889f7e" title="Data interval setting. This is the time between frames in 1/10&amp;#39;s of a second...">frameInterval</a>;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="keyword">extern</span> uint8_t <a class="code" href="group__avr6lowpan__example.html#ga1f8400d1913a42745c2530995f30f8d" title="Store destination address of commands.">destipAddr</a>[];
<a name="l00086"></a>00086 <span class="keyword">extern</span> uint8_t <a class="code" href="group__avr6lowpan__example.html#gf89d4fb3cf6fbe62a1345ed6e8b07030" title="Store destination address of server.">googleipAddr</a>[];
<a name="l00087"></a>00087 <span class="keyword">extern</span> uint8_t serveripAddr[];
<a name="l00088"></a>00088 
<a name="l00141"></a>00141 <span class="preprocessor">#define TRACKDEMO 0</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>
<a name="l00143"></a>00143 <span class="comment">// Application variables</span>
<a name="l00144"></a><a class="code" href="group__app.html#gc9d93da3edaa843172afc4449340d356">00144</a> <span class="keyword">static</span> u8 <a class="code" href="group__app.html#gc9d93da3edaa843172afc4449340d356" title="Number of transmit-to-parent failures before re-scanning.">failCount</a>;  
<a name="l00145"></a>00145 <span class="keyword">volatile</span> u8 gotPanCoordPing;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="comment">// Function declarations</span>
<a name="l00148"></a>00148 <span class="keywordtype">void</span> <a class="code" href="group__app.html#g83f230018f0884c336002b3005395314" title="Example function, starts the network by scanning channels for a coordinator.">appStartScan</a>(<span class="keywordtype">void</span>);
<a name="l00149"></a>00149 <span class="keywordtype">void</span> ledcallback(<span class="keywordtype">void</span>);
<a name="l00150"></a>00150 <span class="keywordtype">void</span> <a class="code" href="group__app.html#g9b846160a17878fbb5a2a93137917d07" title="Called when button on physical device is pressed, or a command to simulate pressing...">sixlowpan_button</a>(<span class="keywordtype">void</span>);
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 <span class="preprocessor">#if __arm__</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span>
<a name="l00156"></a><a class="code" href="group__app.html#gcdecc5a66147c3fd56cdfb06aa0cc113">00156</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#gcdecc5a66147c3fd56cdfb06aa0cc113" title="This will toggle the led of choice on.">ledOn</a>(u8 val)
<a name="l00157"></a>00157 {
<a name="l00158"></a>00158     <span class="keywordflow">if</span>(1 == val) LED1ON();
<a name="l00159"></a>00159     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(2 == val) LED2ON();
<a name="l00160"></a>00160     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(3 == val) LED3ON();
<a name="l00161"></a>00161     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(4 == val) LED4ON();
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 
<a name="l00167"></a><a class="code" href="group__app.html#g78d443dcea1d0895bf7bd56b5b56c841">00167</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g78d443dcea1d0895bf7bd56b5b56c841" title="This will toggle the led of choice off.">ledOff</a>(u8 val)
<a name="l00168"></a>00168 {
<a name="l00169"></a>00169     <span class="keywordflow">if</span>(1 == val) LED1OFF();
<a name="l00170"></a>00170     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(2 == val) LED2OFF();
<a name="l00171"></a>00171     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(3 == val) LED3OFF();
<a name="l00172"></a>00172     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(4 == val) LED4OFF();
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 <span class="preprocessor">#endif // __arm__</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span>
<a name="l00176"></a>00176 <span class="comment">// These LED functions are used to provide address callbacks for macSetAlarm.</span>
<a name="l00177"></a>00177 <span class="comment">// Cannot use defines directly in callbacks.</span>
<a name="l00178"></a>00178 <span class="keywordtype">void</span> ledoff1(<span class="keywordtype">void</span>)
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180     LED_OFF(1);
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="keywordtype">void</span> ledoff2(<span class="keywordtype">void</span>)
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185     LED_OFF(2);
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="keywordtype">void</span> ledoff3(<span class="keywordtype">void</span>)
<a name="l00189"></a>00189 {
<a name="l00190"></a>00190     LED_OFF(3);
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="comment">// This function can be used for diagnostic reasons. Not used in RUM application.</span>
<a name="l00194"></a>00194 <span class="keywordtype">void</span> blink1(<span class="keywordtype">void</span>)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196     LED_ON(1);
<a name="l00197"></a>00197     <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(25, ledoff1);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <span class="comment">//    macSetAlarm(500, blink1);</span>
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <span class="comment">//    macDataRequest(0, 7, (u8*)"Howdy\r\n");</span>
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00210"></a><a class="code" href="group__app.html#gb662b36ea9f9a0c67dbf1220b60edf32">00210</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#gb662b36ea9f9a0c67dbf1220b60edf32" title="Application callback function, called when the MAC receives a ping request packet...">appPingReq</a>(u16 addr)
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212     <span class="comment">// We got a ping, send a response</span>
<a name="l00213"></a>00213     <span class="comment">// Blip the LED</span>
<a name="l00214"></a>00214     LED_ON(1);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(<span class="comment">/* LED_PING_DELAY */</span> 1 ,ledoff1);
<a name="l00217"></a>00217 
<a name="l00218"></a>00218     debugMsgStr(<span class="stringliteral">"\r\nPing request from node "</span>);
<a name="l00219"></a>00219     debugMsgInt(addr);
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <span class="keywordflow">if</span> (<a class="code" href="group__radio.html#g1fa4f1561216be34f745f32aaa38d943" title="Defines the platform for which we are building the firmware.">PLATFORM</a> == <a class="code" href="group__radio.html#g462055ac8fe135ee319e31370d301016" title="Raven demo board (with LCD display).">RAVEN</a> &amp;&amp; <a class="code" href="group__serial.html#gae3f0b4211ba45d265973d40ccbb5fd1" title="Flag to enable the serial port.">SERIAL</a>)
<a name="l00222"></a>00222         <span class="comment">// Tell 3290p</span>
<a name="l00223"></a>00223         serial_send_frame(REPORT_PING_BEEP, 2, (u8*)&amp;addr);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     <a class="code" href="group__mac__data.html#g7e4c5d07ec7a2622dabbcf51b1fe4ba9" title="Send a ping packet (either request or response) to another node.">macPing</a>(<a class="code" href="group__mac.html#g54b3bc6f08ede227e3a0180fc5665425" title="Ping response frame.">PING_RSP_FRAME</a>, addr);
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 
<a name="l00234"></a><a class="code" href="group__app.html#ga5a5e465de3a633997c3e248ae1ab632">00234</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#ga5a5e465de3a633997c3e248ae1ab632" title="Application callback function, called when the MAC receives a ping response packet...">appPingRsp</a>(u16 addr)
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236     debugMsgStr(<span class="stringliteral">"\r\nPing response from "</span>);
<a name="l00237"></a>00237     debugMsgHex(addr);
<a name="l00238"></a>00238     debugMsgStr(<span class="stringliteral">" LQI="</span>);
<a name="l00239"></a>00239     debugMsgInt(<a class="code" href="group__radio.html#gb89f723b3d8357a3c254083b36bef539" title="Retrieves the saved LQI (Link Quality Indication) value.">radioGetSavedLqiValue</a>());
<a name="l00240"></a>00240     debugMsgStr(<span class="stringliteral">" RSSI="</span>);
<a name="l00241"></a>00241     debugMsgInt(<a class="code" href="group__radio.html#g8a4202486f04e061df72ec19973be447" title="Retrieves the saved RSSI (Received Signal Strength Indication) value.">radioGetSavedRssiValue</a>());
<a name="l00242"></a>00242     debugMsgCrLf();
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     <span class="keywordflow">if</span> (<a class="code" href="group__radio.html#g1fa4f1561216be34f745f32aaa38d943" title="Defines the platform for which we are building the firmware.">PLATFORM</a> == <a class="code" href="group__radio.html#g462055ac8fe135ee319e31370d301016" title="Raven demo board (with LCD display).">RAVEN</a> &amp;&amp; <a class="code" href="group__serial.html#gae3f0b4211ba45d265973d40ccbb5fd1" title="Flag to enable the serial port.">SERIAL</a>)
<a name="l00245"></a>00245         <span class="comment">// Tell 3290p</span>
<a name="l00246"></a>00246         serial_send_frame(REPORT_PING_BEEP, 2, (u8*)&amp;addr);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <span class="comment">// turn on the LED</span>
<a name="l00249"></a>00249     LED_ON(1);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251     <span class="comment">// and make it turn off after a litte bit</span>
<a name="l00252"></a>00252     <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(<a class="code" href="group__mac.html#g12a46d6ff86950784521c2446d84b2fc" title="mSec to wait before turning off LED">LED_DELAY</a>,ledoff1);
<a name="l00253"></a>00253 <span class="preprocessor">#if(__arm__)</span>
<a name="l00254"></a>00254 <span class="preprocessor"></span>    gotPanCoordPing = 1;
<a name="l00255"></a>00255 <span class="preprocessor">#endif</span>
<a name="l00256"></a>00256 <span class="preprocessor"></span>}
<a name="l00257"></a>00257 
<a name="l00262"></a><a class="code" href="group__app.html#gfeee90add49d6170d365da9329fa3a91">00262</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#gfeee90add49d6170d365da9329fa3a91" title="Application callback function.">appSixlowpanPingResponse</a>(<span class="keywordtype">void</span>)
<a name="l00263"></a>00263 {
<a name="l00264"></a>00264     <span class="keywordflow">if</span> (<a class="code" href="group__radio.html#g1fa4f1561216be34f745f32aaa38d943" title="Defines the platform for which we are building the firmware.">PLATFORM</a> == <a class="code" href="group__radio.html#g462055ac8fe135ee319e31370d301016" title="Raven demo board (with LCD display).">RAVEN</a>)
<a name="l00265"></a>00265         <span class="comment">// Send the 3290 a frame to show that we got a ping response.</span>
<a name="l00266"></a>00266         serial_send_frame(REPORT_PING_BEEP, 0, NULL);
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00273"></a><a class="code" href="group__app.html#g165181964bf513258f8c195c36483774">00273</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g165181964bf513258f8c195c36483774" title="Application callback function, called when the MAC receives an ACK packet from a...">appPacketSendSucceed</a>(<span class="keywordtype">void</span>)
<a name="l00274"></a>00274 {
<a name="l00275"></a>00275     <span class="comment">// Reset the failure count on a good packet to parent</span>
<a name="l00276"></a>00276     <span class="comment">// (could also decrement failCount)</span>
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> != <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l00279"></a>00279     {
<a name="l00280"></a>00280         <span class="comment">// figure out which way we were sending when the failure occurred</span>
<a name="l00281"></a>00281         <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#76d4f685b3d22a842626cb2a1542d912" title="Used to process send failures.">lastDestAddr</a> == <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#8746018dfd92c5ea8b5dcd12e89dd767" title="The short address of the parent&amp;#39;s node.">parentShortAddress</a>)
<a name="l00282"></a>00282             <a class="code" href="group__app.html#gc9d93da3edaa843172afc4449340d356" title="Number of transmit-to-parent failures before re-scanning.">failCount</a> = 0;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         <span class="comment">// Tell sensor app</span>
<a name="l00285"></a>00285         <span class="keywordflow">if</span> (APP == <a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a>)
<a name="l00286"></a>00286             <a class="code" href="group__sensors.html#gc19b9d07f0d5fbd26244c134f727a6a5" title="This node has successfully sent a packet, and this function is called when that happens...">sensorPacketSendSucceed</a>();
<a name="l00287"></a>00287 
<a name="l00288"></a>00288         <span class="comment">// Tell IPv6 LOWPAN</span>
<a name="l00289"></a>00289         <span class="keywordflow">if</span> (<a class="code" href="group__app.html#gfb4e3c89d60cf32cc974d72af22f5425" title="Enable or disable the IPV6/6LoWPAN layer by setting this macro to 1 (on) or 0 (off)...">IPV6LOWPAN</a>)
<a name="l00290"></a>00290             sixlowpanSleep_packetSucceed();
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 
<a name="l00298"></a><a class="code" href="group__app.html#g0686170052677b61bf884357e98354b6">00298</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g0686170052677b61bf884357e98354b6" title="Application callback function, called when the MAC fails to send a packet due to...">appPacketSendAccessFail</a>(<span class="keywordtype">void</span>)
<a name="l00299"></a>00299 {
<a name="l00300"></a>00300     <span class="comment">// Tell sensor app</span>
<a name="l00301"></a>00301     <span class="keywordflow">if</span> (APP == <a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a>)
<a name="l00302"></a>00302         <a class="code" href="group__sensors.html#g1e9d45b57b1e75c02f3f03ea08116bd8" title="This node has failed to send a packet.">sensorPacketSendFailed</a>();
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00309"></a><a class="code" href="group__app.html#gaab9f419d476077682bd9e42b06aad39">00309</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#gaab9f419d476077682bd9e42b06aad39" title="Application callback function, called when the MAC fails to receive an ACK packet...">appPacketSendFailed</a>(<span class="keywordtype">void</span>)
<a name="l00310"></a>00310 {
<a name="l00311"></a>00311 
<a name="l00312"></a>00312     <span class="comment">//Tell 6LoWPAN</span>
<a name="l00313"></a>00313 <span class="preprocessor">    #if IPV6LOWPAN</span>
<a name="l00314"></a>00314 <span class="preprocessor"></span>        <a class="code" href="group__avr6lowpansleeping.html#g63b3d36dbd98ea58d7006bf6320f0cd5" title="Called by RUM when sending a packet failed.">sixlowpanSleep_packetFailed</a>();
<a name="l00315"></a>00315 <span class="preprocessor">    #endif</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>
<a name="l00317"></a>00317     u8 parentFailed;
<a name="l00318"></a>00318     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> != <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l00319"></a>00319     {
<a name="l00320"></a>00320         <span class="comment">// don't mess with assessing failures during scanning</span>
<a name="l00321"></a>00321         <span class="keywordflow">if</span> (<a class="code" href="group__mac__scan.html#g92f5262200ca45d25313feb542d9c30b" title="Reports whether the MAC is currently scanning.">macIsScanning</a>())
<a name="l00322"></a>00322             <span class="keywordflow">return</span>;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324         debugMsgStr(<span class="stringliteral">"\r\nFail="</span>);
<a name="l00325"></a>00325         debugMsgInt(<a class="code" href="group__app.html#gc9d93da3edaa843172afc4449340d356" title="Number of transmit-to-parent failures before re-scanning.">failCount</a>+1);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327         parentFailed = (<a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#76d4f685b3d22a842626cb2a1542d912" title="Used to process send failures.">lastDestAddr</a> == <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#8746018dfd92c5ea8b5dcd12e89dd767" title="The short address of the parent&amp;#39;s node.">parentShortAddress</a>);
<a name="l00328"></a>00328         <span class="comment">/* Special code: this prevents a situation where the</span>
<a name="l00329"></a>00329 <span class="comment">           coordingator goes away, and the nodes take a long time to</span>
<a name="l00330"></a>00330 <span class="comment">           realize that the network is gone.  Nodes Keep trying to</span>
<a name="l00331"></a>00331 <span class="comment">           re-associate with each other, but until a router loses a</span>
<a name="l00332"></a>00332 <span class="comment">           number of packets to its parent, it still thinks it's</span>
<a name="l00333"></a>00333 <span class="comment">           associated.  This code forces the issue by either verifying</span>
<a name="l00334"></a>00334 <span class="comment">           that the router is still connected, or forcing a failure.    */</span>
<a name="l00335"></a>00335         <span class="comment">// Send an empty data packet</span>
<a name="l00336"></a>00336         <span class="keywordflow">if</span> (parentFailed &amp;&amp; <a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#g5794c1a5f0eedfe85aea59330c25848a" title="Router node.">ROUTER</a>)
<a name="l00337"></a>00337             <a class="code" href="group__mac__data.html#g57df637c21a2060c49e6e19c09b38d30" title="The macsixlowpanDataRequest function is used to send a frame over the air to another...">macDataRequest</a>(<a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#8746018dfd92c5ea8b5dcd12e89dd767" title="The short address of the parent&amp;#39;s node.">parentShortAddress</a>, 0, NULL);
<a name="l00338"></a>00338 
<a name="l00339"></a>00339         <span class="comment">// Don't have a cow until we have missed a few packets in a row</span>
<a name="l00340"></a>00340         <span class="keywordflow">if</span> (++<a class="code" href="group__app.html#gc9d93da3edaa843172afc4449340d356" title="Number of transmit-to-parent failures before re-scanning.">failCount</a> &lt; 8)
<a name="l00341"></a>00341         {
<a name="l00342"></a>00342             <span class="comment">// Tell sensor app</span>
<a name="l00343"></a>00343             <span class="keywordflow">if</span> (APP == <a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a>)
<a name="l00344"></a>00344                 <a class="code" href="group__sensors.html#g1e9d45b57b1e75c02f3f03ea08116bd8" title="This node has failed to send a packet.">sensorPacketSendFailed</a>();
<a name="l00345"></a>00345             <span class="keywordflow">return</span>;
<a name="l00346"></a>00346         }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348         <span class="comment">// A sent packet failed to reach its destination too many times</span>
<a name="l00349"></a>00349         <span class="comment">// figure out which way we were sending when the failure occurred</span>
<a name="l00350"></a>00350         <span class="keywordflow">if</span> (parentFailed)
<a name="l00351"></a>00351         {
<a name="l00352"></a>00352             <span class="comment">// re-associate if we were sending upstream</span>
<a name="l00353"></a>00353             <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#b90d9d43eb3ae9d98e9cd556272bf464" title="Is this node associated with a network?">associated</a> = <span class="keyword">false</span>;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355             <span class="comment">// It is possible to make the coord/end units re-connect</span>
<a name="l00356"></a>00356             <span class="comment">// to the coordinator more quickly by not scanning all</span>
<a name="l00357"></a>00357             <span class="comment">// available channels.  To do this, uncomment the following</span>
<a name="l00358"></a>00358             <span class="comment">// line.</span>
<a name="l00359"></a>00359             <span class="comment">// macSetScanChannel(macConfig.currentChannel);</span>
<a name="l00360"></a>00360 
<a name="l00361"></a>00361             <span class="keywordflow">if</span> (APP == <a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a>)
<a name="l00362"></a>00362                 <a class="code" href="group__sensors.html#gd9a0ce8079a3c9aeb57f592608a4fd2d" title="This node has lost its network connection.">sensorLostNetwork</a>();
<a name="l00363"></a>00363             <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>((<a class="code" href="group__radio.html#g301044554e9d047bf22935d01c615884" title="Returns a random number, composed of bits from the radio&amp;#39;s random number generator...">radioRandom</a>(8)+5) *10, <a class="code" href="group__app.html#g83f230018f0884c336002b3005395314" title="Example function, starts the network by scanning channels for a coordinator.">appStartScan</a>);
<a name="l00364"></a>00364         }
<a name="l00365"></a>00365         <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#g5794c1a5f0eedfe85aea59330c25848a" title="Router node.">ROUTER</a> &amp;&amp;
<a name="l00366"></a>00366             <a class="code" href="group__mac__associate.html#ged6df4ec4a8b1f717d6591f7bc73627a" title="Determine if a given node is a child if this node.">macIsChild</a>(<a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#76d4f685b3d22a842626cb2a1542d912" title="Used to process send failures.">lastDestAddr</a>))
<a name="l00367"></a>00367         {
<a name="l00368"></a>00368             <span class="comment">// Drop child from table if the failure was downstream</span>
<a name="l00369"></a>00369             <a class="code" href="group__mac__associate.html#g18e0aeff533ca9a9e8bb2788eb8648e1" title="Remove a node from the child table.">macRemoveChild</a>(<a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#76d4f685b3d22a842626cb2a1542d912" title="Used to process send failures.">lastDestAddr</a>);
<a name="l00370"></a>00370             debugMsgStr(<span class="stringliteral">"\r\nDropped child bcs packet send failed."</span>);
<a name="l00371"></a>00371         }
<a name="l00372"></a>00372     }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 }
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 <span class="preprocessor">#if DEBUG || DOXYGEN</span>
<a name="l00377"></a>00377 <span class="preprocessor"></span>
<a name="l00382"></a><a class="code" href="group__app.html#g14eb80a0b4a205772927c7991bd7318f">00382</a> u8 <a class="code" href="group__app.html#g14eb80a0b4a205772927c7991bd7318f" title="This is an array of radio register names for serial output used when rf2xx_reg_dump()...">rf2xx_reg_names</a>[][16] =
<a name="l00383"></a>00383     {<span class="stringliteral">"TRX_STATUS"</span>, <span class="stringliteral">"TRX_STATE"</span>, <span class="stringliteral">"TRX_CTRL_0"</span>, <span class="stringliteral">"TRX_CTRL_1"</span>, <span class="stringliteral">"PHY_TX_PWR"</span>,
<a name="l00384"></a>00384      <span class="stringliteral">"PHY_RSSI"</span>, <span class="stringliteral">"PHY_ED_LEVEL"</span>, <span class="stringliteral">"PHY_CC_CCA"</span>, <span class="stringliteral">"CCA_THRES"</span>, <span class="stringliteral">"TRX_CTRL_2"</span>, <span class="stringliteral">"IRQ_MASK"</span>,
<a name="l00385"></a>00385      <span class="stringliteral">"IRQ_STATUS"</span>, <span class="stringliteral">"VREG_CTRL"</span>, <span class="stringliteral">"BATMON"</span>, <span class="stringliteral">"XOSC_CTRL"</span>, <span class="stringliteral">"RX_SYN"</span>, <span class="stringliteral">"RF_CTRL_0"</span>, <span class="stringliteral">"XAH_CTRL_1"</span>,
<a name="l00386"></a>00386      <span class="stringliteral">"FTN_CTRL"</span>, <span class="stringliteral">"RF_CTRL_1"</span>, <span class="stringliteral">"PLL_CF"</span>, <span class="stringliteral">"PLL_DCU"</span>, <span class="stringliteral">"PART_NUM"</span>, <span class="stringliteral">"VERSION_NUM"</span>, <span class="stringliteral">"MAN_ID_0"</span>,
<a name="l00387"></a>00387      <span class="stringliteral">"MAN_ID_1"</span>, <span class="stringliteral">"SHORT_ADDR_0"</span>, <span class="stringliteral">"SHORT_ADDR_1"</span>, <span class="stringliteral">"PAN_ID_0"</span>, <span class="stringliteral">"PAN_ID_1"</span>,
<a name="l00388"></a>00388      <span class="stringliteral">"IEEE_ADDR_0"</span>, <span class="stringliteral">"IEEE_ADDR_1"</span>, <span class="stringliteral">"IEEE_ADDR_2"</span>, <span class="stringliteral">"IEEE_ADDR_3"</span>, <span class="stringliteral">"IEEE_ADDR_4"</span>,
<a name="l00389"></a>00389      <span class="stringliteral">"IEEE_ADDR_5"</span>, <span class="stringliteral">"IEEE_ADDR_6"</span>, <span class="stringliteral">"IEEE_ADDR_7"</span>, <span class="stringliteral">"XAH_CTRL_0"</span>, <span class="stringliteral">"CSMA_SEED_0"</span>,
<a name="l00390"></a>00390      <span class="stringliteral">"CSMA_SEED_1"</span>, <span class="stringliteral">"CSMA_BE"</span>};
<a name="l00391"></a>00391 
<a name="l00397"></a><a class="code" href="group__app.html#g86b6dc81235bd2fbc7cf4ff7a19e2289">00397</a> u8 <a class="code" href="group__app.html#g86b6dc81235bd2fbc7cf4ff7a19e2289" title="This is an array of radio register values to be used when rf2xx_reg_dump() is called...">rf2xx_reg_enum</a>[] =
<a name="l00398"></a>00398     {<a class="code" href="group__radio__registers.html#g3ef224e06f9b07c132b98daeb089f9ae" title="Offset for register TRX_STATUS.">RG_TRX_STATUS</a>, <a class="code" href="group__radio__registers.html#g9154e18a2399240c300da352be8c14c5" title="Offset for register TRX_STATE.">RG_TRX_STATE</a>, <a class="code" href="group__radio__registers.html#g5025f89755df39a2fdede980b2907eff" title="Offset for register TRX_CTRL_0.">RG_TRX_CTRL_0</a>, <a class="code" href="group__radio__registers.html#g1d1e66a62e8f748c93a2143ebc262d15" title="Offset for register TRX_CTRL_1.">RG_TRX_CTRL_1</a>, <a class="code" href="group__radio__registers.html#g102bbda4e4354e6c5d42d73a8202476d" title="Offset for register PHY_TX_PWR.">RG_PHY_TX_PWR</a>,
<a name="l00399"></a>00399      <a class="code" href="group__radio__registers.html#gd1d60be2e5a79f872e2da65ff35dd90a" title="Offset for register PHY_RSSI.">RG_PHY_RSSI</a>, <a class="code" href="group__radio__registers.html#g4caa8e52e3f9ad2217864df65fdfd501" title="Offset for register PHY_ED_LEVEL.">RG_PHY_ED_LEVEL</a>, <a class="code" href="group__radio__registers.html#g16019b8196d6eb4a2bbf28c3bfe9112d" title="Offset for register PHY_CC_CCA.">RG_PHY_CC_CCA</a>, <a class="code" href="group__radio__registers.html#g363aeed705736bd833f6c66e101c2e65" title="Offset for register CCA_THRES.">RG_CCA_THRES</a>, <a class="code" href="group__radio__registers.html#g81791c12a60718398f0747eb2e9625d8" title="Offset for register TRX_CTRL_2.">RG_TRX_CTRL_2</a>, <a class="code" href="group__radio__registers.html#g905b648376932649f2af990f20a03df6" title="Offset for register IRQ_MASK.">RG_IRQ_MASK</a>,
<a name="l00400"></a>00400      <a class="code" href="group__radio__registers.html#g7dec4b1e3d3bfd3e9f6c243abc4f008e" title="Offset for register IRQ_STATUS.">RG_IRQ_STATUS</a>, <a class="code" href="group__radio__registers.html#g5f8811938f2f1f073d35ff0a54ee830a" title="Offset for register VREG_CTRL.">RG_VREG_CTRL</a>, <a class="code" href="group__radio__registers.html#gb47fb56bf39aa80785b9c803ac68bdcd" title="Offset for register BATMON.">RG_BATMON</a>, <a class="code" href="group__radio__registers.html#gcc9cb84a4de2da69f74351048c08d5c5" title="Offset for register XOSC_CTRL.">RG_XOSC_CTRL</a>, <a class="code" href="group__radio__registers.html#gf72185a3c627bf76403dc38f3c356a26" title="Offset for register RX_SYN.">RG_RX_SYN</a>, RG_RF_CTRL_0, <a class="code" href="group__radio__registers.html#ge9477feb3c263ec41f78b52c22ea863d" title="Offset for register XAH_CTRL_1.">RG_XAH_CTRL_1</a>,
<a name="l00401"></a>00401      <a class="code" href="group__radio__registers.html#g6e1e5bbc54be46b1bba0cf16868a9922" title="Offset for register FTN_CTRL.">RG_FTN_CTRL</a>, RG_RF_CTRL_0, <a class="code" href="group__radio__registers.html#ga6916dc7c962c78af9a11fa86388c097" title="Offset for register PLL_CF.">RG_PLL_CF</a>, <a class="code" href="group__radio__registers.html#gcd8356b2e26de3de8ce5df0bc8ac52b6" title="Offset for register PLL_DCU.">RG_PLL_DCU</a>, <a class="code" href="group__radio__registers.html#g72ebcdb3490edf9a0af95c5feba492fc" title="Offset for register PART_NUM.">RG_PART_NUM</a>, <a class="code" href="group__radio__registers.html#gc1888aaec44899f2a3d7856b757533e8" title="Offset for register VERSION_NUM.">RG_VERSION_NUM</a>, <a class="code" href="group__radio__registers.html#g3514dae6641c832c5223c74151544f17" title="Offset for register MAN_ID_0.">RG_MAN_ID_0</a>,
<a name="l00402"></a>00402      <a class="code" href="group__radio__registers.html#g6c961f3a2c267656eb8d90c103ab96aa" title="Offset for register MAN_ID_1.">RG_MAN_ID_1</a>, <a class="code" href="group__radio__registers.html#g7eb78713946ea45d4b96dea4fdfd635b" title="Offset for register SHORT_ADDR_0.">RG_SHORT_ADDR_0</a>, <a class="code" href="group__radio__registers.html#ga60598fa1041cdf9caa245cc9fbd52cd" title="Offset for register SHORT_ADDR_1.">RG_SHORT_ADDR_1</a>, <a class="code" href="group__radio__registers.html#g7e9a100296620bd87365a5355e3ff28d" title="Offset for register PAN_ID_0.">RG_PAN_ID_0</a>, <a class="code" href="group__radio__registers.html#g30cf03f218f9c36554315f737abbedd5" title="Offset for register PAN_ID_1.">RG_PAN_ID_1</a>,
<a name="l00403"></a>00403      <a class="code" href="group__radio__registers.html#g15e749d4ff747c1066a644142088c354" title="Offset for register IEEE_ADDR_0.">RG_IEEE_ADDR_0</a>, <a class="code" href="group__radio__registers.html#g1446d842abbb6236c0cc6e81aa55afd5" title="Offset for register IEEE_ADDR_1.">RG_IEEE_ADDR_1</a>, <a class="code" href="group__radio__registers.html#gddc18e32ea6a4e7090d003a065325a07" title="Offset for register IEEE_ADDR_2.">RG_IEEE_ADDR_2</a>, <a class="code" href="group__radio__registers.html#g4363d1043e3ca7fd103c8671a7bb816c" title="Offset for register IEEE_ADDR_3.">RG_IEEE_ADDR_3</a>, <a class="code" href="group__radio__registers.html#g0af60fe759f1fb20a5fd1f1a6485ef55" title="Offset for register IEEE_ADDR_4.">RG_IEEE_ADDR_4</a>,
<a name="l00404"></a>00404      <a class="code" href="group__radio__registers.html#g51e16dcb63978ac7f2da04f1d22f64d5" title="Offset for register IEEE_ADDR_5.">RG_IEEE_ADDR_5</a>, <a class="code" href="group__radio__registers.html#g7a08fe5c18ce6b6aab8258e60437dbbd" title="Offset for register IEEE_ADDR_6.">RG_IEEE_ADDR_6</a>, <a class="code" href="group__radio__registers.html#gfc4833334492f3f1ca57d51f96a4a925" title="Offset for register IEEE_ADDR_7.">RG_IEEE_ADDR_7</a>, <a class="code" href="group__radio__registers.html#g965e63c5144865f3e88d85a714362e68" title="Offset for register XAH_CTRL.">RG_XAH_CTRL_0</a>, <a class="code" href="group__radio__registers.html#g0be03a19a6b1cf46a550cd0a5dc1b55b" title="Offset for register CSMA_SEED_0.">RG_CSMA_SEED_0</a>,
<a name="l00405"></a>00405      <a class="code" href="group__radio__registers.html#gd13c7575f9673b164a24725b3046afd3" title="Offset for register CSMA_SEED_1.">RG_CSMA_SEED_1</a>, <a class="code" href="group__radio__registers.html#g27a2452254bf5ec820d5f60254cc5c80" title="Offset for register CSMA_BE.">RG_CSMA_BE</a>};
<a name="l00406"></a>00406 <span class="preprocessor">#endif</span>
<a name="l00407"></a>00407 <span class="preprocessor"></span>
<a name="l00414"></a><a class="code" href="group__app.html#g73d2d3a9fcc954b754974d35bbd85011">00414</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g73d2d3a9fcc954b754974d35bbd85011" title="Dumps the RF2xx register contents to serial port.">rf2xx_reg_dump</a>(<span class="keywordtype">void</span>)
<a name="l00415"></a>00415 {
<a name="l00416"></a>00416 <span class="preprocessor">#if DEBUG</span>
<a name="l00417"></a>00417 <span class="preprocessor"></span>    {
<a name="l00418"></a>00418         u8 i,j,k,val;
<a name="l00419"></a>00419         s8 str[40];
<a name="l00420"></a>00420 
<a name="l00421"></a>00421         debugMsgStr(<span class="stringliteral">"\r\n\r\nREG DUMP\r\n"</span>);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423         k = <span class="keyword">sizeof</span>(<a class="code" href="group__app.html#g86b6dc81235bd2fbc7cf4ff7a19e2289" title="This is an array of radio register values to be used when rf2xx_reg_dump() is called...">rf2xx_reg_enum</a>);
<a name="l00424"></a>00424         <span class="keywordflow">for</span>(i=0;i&lt;k;i++)
<a name="l00425"></a>00425         {
<a name="l00426"></a>00426             val =  <a class="code" href="group__arm.html#gfd58b0cad5bbd45b1c4a8d30be4bc11c" title="This function reads data from one of the radio transceiver&amp;#39;s registers.">hal_register_read</a>(<a class="code" href="group__app.html#g86b6dc81235bd2fbc7cf4ff7a19e2289" title="This is an array of radio register values to be used when rf2xx_reg_dump() is called...">rf2xx_reg_enum</a>[i]);
<a name="l00427"></a>00427             sprintf((<span class="keywordtype">char</span>*)str,<span class="stringliteral">"%-15s - %02X "</span>, (<span class="keywordtype">char</span> *)<a class="code" href="group__app.html#g14eb80a0b4a205772927c7991bd7318f" title="This is an array of radio register names for serial output used when rf2xx_reg_dump()...">rf2xx_reg_names</a>[i], (uint16_t)val);
<a name="l00428"></a>00428             debugMsgStr((<span class="keywordtype">char</span> *)str);
<a name="l00429"></a>00429             <span class="keywordflow">for</span> (j=7;j&lt;8;j--)
<a name="l00430"></a>00430                 <span class="comment">// Print a bit</span>
<a name="l00431"></a>00431                 debugMsgChr(((val &gt;&gt; j)&amp;1 ? <span class="charliteral">'1'</span> : <span class="charliteral">'0'</span> ));
<a name="l00432"></a>00432             debugMsgCrLf();
<a name="l00433"></a>00433         }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435         debugMsgStr(<span class="stringliteral">"\r\n"</span>);
<a name="l00436"></a>00436     }
<a name="l00437"></a>00437 <span class="preprocessor">#endif</span>
<a name="l00438"></a>00438 <span class="preprocessor"></span>}
<a name="l00439"></a>00439 
<a name="l00447"></a><a class="code" href="group__app.html#g10755c77589f052ad104aa345beab98c">00447</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g10755c77589f052ad104aa345beab98c" title="Application function, sends a data frame to the coordinator, and schedules another...">appSendDataFrame</a>(<span class="keywordtype">void</span>)
<a name="l00448"></a>00448 {
<a name="l00449"></a>00449     <span class="comment">// send data frames once per second</span>
<a name="l00450"></a>00450     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> != <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l00451"></a>00451         <a class="code" href="group__mac__data.html#g57df637c21a2060c49e6e19c09b38d30" title="The macsixlowpanDataRequest function is used to send a frame over the air to another...">macDataRequest</a>(0x00, 4, (u8*) ((<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#gfa11cf93bface598cd7a0fa88a71285c" title="End node.">ENDDEVICE</a>) ? <span class="stringliteral">"endd"</span> : <span class="stringliteral">"rout"</span>));
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     <span class="comment">// Send another data frame later</span>
<a name="l00454"></a>00454     <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(1000, <a class="code" href="group__app.html#g10755c77589f052ad104aa345beab98c" title="Application function, sends a data frame to the coordinator, and schedules another...">appSendDataFrame</a>);
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00468"></a><a class="code" href="group__app.html#g24a5a30fe61f32e1bd405f431bd46527">00468</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g24a5a30fe61f32e1bd405f431bd46527" title="Callback function, called when the MAC receives a data packet for this node.">appDataIndication</a>(<span class="keywordtype">void</span>)
<a name="l00469"></a>00469 {
<a name="l00470"></a>00470     <span class="comment">// Write app code here -- This node has received a data frame.</span>
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     <span class="comment">// Example code:</span>
<a name="l00473"></a>00473 
<a name="l00474"></a>00474     <span class="comment">// Find out the type of packet</span>
<a name="l00475"></a>00475     <a class="code" href="structftData.html" title="Data packet, used for data and some MAC functions (see type element).">ftData</a> *frame = (<a class="code" href="structftData.html" title="Data packet, used for data and some MAC functions (see type element).">ftData</a> *)(<a class="code" href="group__mac.html#gfeaf8ffad6487abe7551f66403cf4bae" title="Global MAC buffer (receive).">mac_buffer_rx</a>+1);
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structftData.html#df2871ec6a3e63416a808a43875a5aba" title="Type of data packet, see DATA_FRAME.">type</a> == <a class="code" href="group__mac.html#g021f896b0d93ef2ac8162dbfad736805" title="Application data frame.">DATA_FRAME</a>)
<a name="l00478"></a>00478     {
<a name="l00479"></a>00479         <span class="comment">// Flash LED when we get a packet back</span>
<a name="l00480"></a>00480         LED_ON(1);
<a name="l00481"></a>00481         <span class="comment">// Turn off LED in a little bit, so it flashes</span>
<a name="l00482"></a>00482         <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(<a class="code" href="group__mac.html#g12a46d6ff86950784521c2446d84b2fc" title="mSec to wait before turning off LED">LED_DELAY</a>,ledoff1);
<a name="l00483"></a>00483 
<a name="l00484"></a>00484         <span class="comment">// pass data to application</span>
<a name="l00485"></a>00485         <span class="keywordflow">if</span> (APP == <a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a>)
<a name="l00486"></a>00486             <a class="code" href="group__sensors.html#gbaa8d61c91f652d5e95e2ec6c9f00b4d" title="Handle a received packet.">sensorRcvPacket</a>(frame-&gt;<a class="code" href="structftData.html#69fa938da0dcef059d9f37f396bd1440" title="First byte of an array of application payload.">payload</a>);
<a name="l00487"></a>00487         <span class="keywordflow">else</span>
<a name="l00488"></a>00488             <span class="comment">// Default application</span>
<a name="l00489"></a>00489             <span class="keywordflow">if</span> (<a class="code" href="group__app.html#gd72dbcf6d0153db1b8d8a58001feed83" title="The global debugging flag.">DEBUG</a>)
<a name="l00490"></a>00490             {
<a name="l00491"></a>00491                 <span class="comment">// Print data in frame to serial port (streaming mode)</span>
<a name="l00492"></a>00492                 u8 n = *<a class="code" href="group__mac.html#gfeaf8ffad6487abe7551f66403cf4bae" title="Global MAC buffer (receive).">mac_buffer_rx</a> - 16;
<a name="l00493"></a>00493                 <span class="comment">// Terminate the string</span>
<a name="l00494"></a>00494                 frame-&gt;<a class="code" href="structftData.html#69fa938da0dcef059d9f37f396bd1440" title="First byte of an array of application payload.">payload</a>[n] = 0;
<a name="l00495"></a>00495                 <span class="comment">// and print it</span>
<a name="l00496"></a>00496                 debugMsgStr((<span class="keywordtype">char</span> *)(frame-&gt;<a class="code" href="structftData.html#69fa938da0dcef059d9f37f396bd1440" title="First byte of an array of application payload.">payload</a>));
<a name="l00497"></a>00497             }
<a name="l00498"></a>00498     }
<a name="l00499"></a>00499 }
<a name="l00500"></a>00500 
<a name="l00507"></a><a class="code" href="group__app.html#g83f230018f0884c336002b3005395314">00507</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g83f230018f0884c336002b3005395314" title="Example function, starts the network by scanning channels for a coordinator.">appStartScan</a>(<span class="keywordtype">void</span>)
<a name="l00508"></a>00508 {
<a name="l00509"></a>00509     <span class="keywordflow">if</span>(<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> != <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l00510"></a>00510     {
<a name="l00511"></a>00511         debugMsgStr(<span class="stringliteral">"\r\nStart scan"</span>);
<a name="l00512"></a>00512 
<a name="l00513"></a>00513         <a class="code" href="group__mac.html#gaa0748a32ee5741afc6a5078d92158bb" title="Init the mac, which includes initializing the radio chip.">macInit</a>(0xff);
<a name="l00514"></a>00514 
<a name="l00515"></a>00515         <a class="code" href="group__mac__scan.html#g9b962c94bc13ed89a2d2a8590ed487f4" title="Scan channels for coordinators.">macScan</a>();
<a name="l00516"></a>00516     }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518     <span class="keywordflow">if</span> (<a class="code" href="group__app.html#gfb4e3c89d60cf32cc974d72af22f5425" title="Enable or disable the IPV6/6LoWPAN layer by setting this macro to 1 (on) or 0 (off)...">IPV6LOWPAN</a> == 1)
<a name="l00519"></a>00519         <a class="code" href="group__avr6lowpan__example.html#g31a4ca6d7db7f9ec030631ec2251fba2" title="Initilize the 6lowpan application.">sixlowpan_application_init</a>();
<a name="l00520"></a>00520 }
<a name="l00521"></a>00521 
<a name="l00530"></a><a class="code" href="group__app.html#g8536fa62911e3b087d0811af3649b329">00530</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g8536fa62911e3b087d0811af3649b329" title="Callback function, called when the MAC has associated a child of this node to the...">appChildAssociated</a>(u16 shortAddress)
<a name="l00531"></a>00531 {
<a name="l00532"></a>00532     <span class="comment">// Blip the LED when we associate a child</span>
<a name="l00533"></a>00533     LED_ON(1);
<a name="l00534"></a>00534     <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(<a class="code" href="group__mac.html#g12a46d6ff86950784521c2446d84b2fc" title="mSec to wait before turning off LED">LED_DELAY</a>,ledoff1);
<a name="l00535"></a>00535 }
<a name="l00536"></a>00536 
<a name="l00544"></a><a class="code" href="group__app.html#g65f0f14844e8b09a2d33a5b377c56b1b">00544</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g65f0f14844e8b09a2d33a5b377c56b1b" title="Callback function, called when the MAC has associated a new node to a network.">appNodeAssociated</a>(u16 shortAddress)
<a name="l00545"></a>00545 {
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 
<a name="l00555"></a><a class="code" href="group__app.html#g85919e96b4d8f3aee13a5eb3a10dfd03">00555</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g85919e96b4d8f3aee13a5eb3a10dfd03" title="Callback function, called when the MAC receives an association confirm packet addressed...">appAssociateConfirm</a>(u8 success)
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557     <span class="keywordflow">if</span>(<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> != <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l00558"></a>00558     {
<a name="l00559"></a>00559         <span class="keywordflow">if</span> (success == SUCCESS)
<a name="l00560"></a>00560         {
<a name="l00561"></a>00561             <span class="comment">// send data frame after a bit</span>
<a name="l00562"></a>00562             debugMsgStr(<span class="stringliteral">"\r\nAssociated to "</span>);
<a name="l00563"></a>00563             debugMsgHex(<a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#8746018dfd92c5ea8b5dcd12e89dd767" title="The short address of the parent&amp;#39;s node.">parentShortAddress</a>);
<a name="l00564"></a>00564             debugMsgStr(<span class="stringliteral">" as "</span>);
<a name="l00565"></a>00565             debugMsgHex(<a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#410a3539e6e06a2192ef87dfe7ae7424" title="The short address for this node.">shortAddress</a>);
<a name="l00566"></a>00566             LED_ON(1);
<a name="l00567"></a>00567             <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(<a class="code" href="group__mac.html#g12a46d6ff86950784521c2446d84b2fc" title="mSec to wait before turning off LED">LED_DELAY</a>,ledoff1);
<a name="l00568"></a>00568 
<a name="l00569"></a>00569             <span class="comment">// For raven, notify other processor</span>
<a name="l00570"></a>00570             <span class="keywordflow">if</span> (<a class="code" href="group__radio.html#g1fa4f1561216be34f745f32aaa38d943" title="Defines the platform for which we are building the firmware.">PLATFORM</a> == <a class="code" href="group__radio.html#g462055ac8fe135ee319e31370d301016" title="Raven demo board (with LCD display).">RAVEN</a> &amp;&amp; <a class="code" href="group__serial.html#gae3f0b4211ba45d265973d40ccbb5fd1" title="Flag to enable the serial port.">SERIAL</a>)
<a name="l00571"></a>00571                 serial_send_frame(REPORT_ASSOCIATED, 0, NULL);
<a name="l00572"></a>00572 
<a name="l00573"></a>00573             <span class="comment">/* 6lowpan association */</span>
<a name="l00574"></a>00574             <span class="keywordflow">if</span> (<a class="code" href="group__app.html#gfb4e3c89d60cf32cc974d72af22f5425" title="Enable or disable the IPV6/6LoWPAN layer by setting this macro to 1 (on) or 0 (off)...">IPV6LOWPAN</a> == 1)
<a name="l00575"></a>00575                 sixlowpan_hc01_gen_rs();
<a name="l00576"></a>00576 
<a name="l00577"></a>00577             <span class="comment">// If we are auto-sending data, start that process.</span>
<a name="l00578"></a>00578             <span class="keywordflow">if</span> (APP == <a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a> &amp;&amp; <a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> != <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l00579"></a>00579             {
<a name="l00580"></a>00580                 <a class="code" href="group__sensors.html#ge0815bb7fb90effa997f450cedc67ec4" title="Initialize the sensor system by configuring the A/D converter.">sensorInit</a>();
<a name="l00581"></a>00581                 <a class="code" href="group__sensors.html#gcab00d2731b419ed4dbf8e29e57a712a" title="Begin auto-sending data after powerup.">sensorAutoSendStart</a>();
<a name="l00582"></a>00582             }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584 <span class="preprocessor">#if TRACKDEMO</span>
<a name="l00585"></a>00585 <span class="preprocessor"></span>            <span class="comment">// Track Demo Application</span>
<a name="l00586"></a>00586             <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#gfa11cf93bface598cd7a0fa88a71285c" title="End node.">ENDDEVICE</a>)
<a name="l00587"></a>00587             {
<a name="l00588"></a>00588                 <span class="comment">// Re-associate every second</span>
<a name="l00589"></a>00589                 <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(1000, <a class="code" href="group__app.html#g83f230018f0884c336002b3005395314" title="Example function, starts the network by scanning channels for a coordinator.">appStartScan</a>);
<a name="l00590"></a>00590             }
<a name="l00591"></a>00591 <span class="preprocessor">#endif</span>
<a name="l00592"></a>00592 <span class="preprocessor"></span>        }
<a name="l00593"></a>00593         <span class="keywordflow">else</span>
<a name="l00594"></a>00594         {
<a name="l00595"></a>00595             debugMsgStr(<span class="stringliteral">"\r\nFailed to associate"</span>);
<a name="l00596"></a>00596 
<a name="l00597"></a>00597             <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g129500a5752ba8bc8abba3844efe45f6" title="Flag to signify a &amp;quot;very low power&amp;quot; (VLP) node.">VLP</a>)
<a name="l00598"></a>00598             {
<a name="l00599"></a>00599                 <span class="comment">// Sleep for 10 seconds, try again</span>
<a name="l00600"></a>00600                 <a class="code" href="group__sleep.html#g93b5cdc0c2f6e617c9e63fac53cc8271" title="Put the node to sleep.">nodeSleep</a>(100);
<a name="l00601"></a>00601                 <a class="code" href="group__app.html#g83f230018f0884c336002b3005395314" title="Example function, starts the network by scanning channels for a coordinator.">appStartScan</a>();
<a name="l00602"></a>00602             }
<a name="l00603"></a>00603             <span class="keywordflow">else</span>
<a name="l00604"></a>00604                 <span class="comment">// Try again in one second</span>
<a name="l00605"></a>00605             <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(1000, <a class="code" href="group__app.html#g83f230018f0884c336002b3005395314" title="Example function, starts the network by scanning channels for a coordinator.">appStartScan</a>);
<a name="l00606"></a>00606         }
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00614"></a><a class="code" href="group__app.html#g06e926ceb26bd008cc94febe52cffb2d">00614</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g06e926ceb26bd008cc94febe52cffb2d" title="Sample application function, associates this node to a network.">appAssociate</a>(<span class="keywordtype">void</span>)
<a name="l00615"></a>00615 {
<a name="l00616"></a>00616     debugMsgStr(<span class="stringliteral">"\r\nAssociating to "</span>);
<a name="l00617"></a>00617     debugMsgHex(<a class="code" href="group__mac__scan.html#g963e3745ba8bbe555f09a099c8566102" title="PAN Descriptor structure,.">panDescriptor</a>.<a class="code" href="structpanDescriptor__t.html#ef9073f37c69898f538332fba8052d03" title="Short address of the node that sent the beacon.">coordAddr</a>);
<a name="l00618"></a>00618     debugMsgStr(<span class="stringliteral">" on ch "</span>);
<a name="l00619"></a>00619     debugMsgInt(<a class="code" href="group__mac__scan.html#g963e3745ba8bbe555f09a099c8566102" title="PAN Descriptor structure,.">panDescriptor</a>.<a class="code" href="structpanDescriptor__t.html#b88b47c58d2b004636b25fb75557b32a" title="Channel that the PAN operates on.">logicalChannel</a>);
<a name="l00620"></a>00620     debugMsgStr(<span class="stringliteral">", hops = "</span>);
<a name="l00621"></a>00621     debugMsgInt(<a class="code" href="group__mac__scan.html#g963e3745ba8bbe555f09a099c8566102" title="PAN Descriptor structure,.">panDescriptor</a>.<a class="code" href="structpanDescriptor__t.html#8ceeebc221ca893c3a7e322c84f8f19b" title="Number of hops from the beaconing node to the coordinator.">hopsToCoord</a>);
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <a class="code" href="group__mac__associate.html#ge044ad02d7a264fe88176c4076809853" title="Associate this node with a network.">macAssociate</a>(<a class="code" href="group__mac__scan.html#g963e3745ba8bbe555f09a099c8566102" title="PAN Descriptor structure,.">panDescriptor</a>.<a class="code" href="structpanDescriptor__t.html#ef9073f37c69898f538332fba8052d03" title="Short address of the node that sent the beacon.">coordAddr</a>, <a class="code" href="group__mac__scan.html#g963e3745ba8bbe555f09a099c8566102" title="PAN Descriptor structure,.">panDescriptor</a>.<a class="code" href="structpanDescriptor__t.html#b88b47c58d2b004636b25fb75557b32a" title="Channel that the PAN operates on.">logicalChannel</a>);
<a name="l00624"></a>00624 }
<a name="l00625"></a>00625 
<a name="l00632"></a><a class="code" href="group__app.html#g43fb16d48be1908e0a007eaccb6280c9">00632</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g43fb16d48be1908e0a007eaccb6280c9" title="Callback function, called when the MAC has completed its channel scan.">appScanConfirm</a>(u8 success)
<a name="l00633"></a>00633 {
<a name="l00634"></a>00634     <span class="comment">// Write app code here -- This (end) node has finished its scan,</span>
<a name="l00635"></a>00635     <span class="comment">// and has receive a coordinator address.</span>
<a name="l00636"></a>00636 
<a name="l00637"></a>00637     <span class="comment">// Example code:</span>
<a name="l00638"></a>00638     <span class="comment">// scan is done, turn off LED</span>
<a name="l00639"></a>00639     <span class="keywordflow">if</span>(<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> != <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l00640"></a>00640     {
<a name="l00641"></a>00641         <span class="keywordflow">if</span> (success)
<a name="l00642"></a>00642         {
<a name="l00643"></a>00643             <span class="comment">// associate with coordinator</span>
<a name="l00644"></a>00644             <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(10,<a class="code" href="group__app.html#g06e926ceb26bd008cc94febe52cffb2d" title="Sample application function, associates this node to a network.">appAssociate</a>);
<a name="l00645"></a>00645 
<a name="l00646"></a>00646             debugMsgStr(<span class="stringliteral">"\r\nScan good, select chan "</span>);
<a name="l00647"></a>00647             debugMsgInt(<a class="code" href="group__mac__scan.html#g963e3745ba8bbe555f09a099c8566102" title="PAN Descriptor structure,.">panDescriptor</a>.<a class="code" href="structpanDescriptor__t.html#b88b47c58d2b004636b25fb75557b32a" title="Channel that the PAN operates on.">logicalChannel</a>);
<a name="l00648"></a>00648         }
<a name="l00649"></a>00649         <span class="keywordflow">else</span>
<a name="l00650"></a>00650         {
<a name="l00651"></a>00651             <span class="comment">// failure to find a network</span>
<a name="l00652"></a>00652             <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g129500a5752ba8bc8abba3844efe45f6" title="Flag to signify a &amp;quot;very low power&amp;quot; (VLP) node.">VLP</a>)
<a name="l00653"></a>00653             {
<a name="l00654"></a>00654                 <span class="comment">// Try again after sleeping for 10 seconds</span>
<a name="l00655"></a>00655                 <a class="code" href="group__sleep.html#g93b5cdc0c2f6e617c9e63fac53cc8271" title="Put the node to sleep.">nodeSleep</a>(100);
<a name="l00656"></a>00656                 <a class="code" href="group__app.html#g83f230018f0884c336002b3005395314" title="Example function, starts the network by scanning channels for a coordinator.">appStartScan</a>();
<a name="l00657"></a>00657             }
<a name="l00658"></a>00658             <span class="keywordflow">else</span>
<a name="l00659"></a>00659             <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(1000,<a class="code" href="group__app.html#g83f230018f0884c336002b3005395314" title="Example function, starts the network by scanning channels for a coordinator.">appStartScan</a>);
<a name="l00660"></a>00660             debugMsgStr(<span class="stringliteral">"\r\nScan bad"</span>);
<a name="l00661"></a>00661         }
<a name="l00662"></a>00662     }
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 
<a name="l00671"></a><a class="code" href="group__app.html#g8f71d0c0ed4dfe867f3cd0208a1299b6">00671</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g8f71d0c0ed4dfe867f3cd0208a1299b6" title="Callback function, called when macFindClearChannel() completes.">appClearChanFound</a>(u8 channel)
<a name="l00672"></a>00672 {
<a name="l00673"></a>00673     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l00674"></a>00674     {
<a name="l00675"></a>00675         <a class="code" href="group__mac.html#gaa0748a32ee5741afc6a5078d92158bb" title="Init the mac, which includes initializing the radio chip.">macInit</a>(channel);
<a name="l00676"></a>00676         <a class="code" href="group__mac.html#gd9b6aa9e3aa0f562f49354f26bbf56ba" title="This function will cause a device to become a PAN Coordinator.">macStartCoord</a>();
<a name="l00677"></a>00677 <span class="preprocessor">#if (__AVR__)</span>
<a name="l00678"></a>00678 <span class="preprocessor"></span>        debugMsgStr(<span class="stringliteral">"\r\nStartup, I am coordinator on ch "</span>);
<a name="l00679"></a>00679 <span class="preprocessor">#else // __arm__</span>
<a name="l00680"></a>00680 <span class="preprocessor"></span>        fnDebugMsg(<span class="stringliteral">"\r\nStartup, I am coordinator on ch "</span>);
<a name="l00681"></a>00681 <span class="preprocessor">#endif // __AVR__</span>
<a name="l00682"></a>00682 <span class="preprocessor"></span>        debugMsgInt(channel);
<a name="l00683"></a>00683         <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#b90d9d43eb3ae9d98e9cd556272bf464" title="Is this node associated with a network?">associated</a> = <span class="keyword">true</span>;
<a name="l00684"></a>00684 
<a name="l00685"></a>00685         <span class="keywordflow">if</span> (<a class="code" href="group__app.html#gfb4e3c89d60cf32cc974d72af22f5425" title="Enable or disable the IPV6/6LoWPAN layer by setting this macro to 1 (on) or 0 (off)...">IPV6LOWPAN</a> == 1)
<a name="l00686"></a>00686             <span class="comment">//Start uIP stack with 802.15.4 interface</span>
<a name="l00687"></a>00687             tuip_init_802154(<a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#0661aa4bcc924815144446db68168a1f" title="The PAN ID for the network this node is associated with.">panId</a>, <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#410a3539e6e06a2192ef87dfe7ae7424" title="The short address for this node.">shortAddress</a>);
<a name="l00688"></a>00688     }
<a name="l00689"></a>00689 }
<a name="l00690"></a>00690 
<a name="l00691"></a>00691 <span class="preprocessor">#if __AVR__</span>
<a name="l00692"></a>00692 <span class="preprocessor"></span>
<a name="l00700"></a><a class="code" href="group__app.html#g786cdc3a3d24514299181bb559dceff3">00700</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g786cdc3a3d24514299181bb559dceff3" title="Verifies that the EEPROM contains valid data for the stored MAC address.">checkEeprom</a>(<span class="keywordtype">void</span>)
<a name="l00701"></a>00701 {
<a name="l00702"></a>00702     <span class="comment">//if (DEMO == 1)</span>
<a name="l00703"></a>00703     <span class="comment">//if(1)</span>
<a name="l00704"></a>00704     <span class="comment">//{</span>
<a name="l00705"></a>00705         u8 buf[8];
<a name="l00706"></a>00706         u8 i,bad=1;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708         <a class="code" href="group__radio.html#g607f27483d3baea015e9d729cdd3e32d" title="Macro to retrieve MAC address stored in EEPROM.">halGetMacAddr</a>(buf);
<a name="l00709"></a>00709         <span class="keywordflow">for</span> (i=0;i&lt;8;i++)
<a name="l00710"></a>00710             <span class="keywordflow">if</span> (buf[i] != 0xff)
<a name="l00711"></a>00711             {
<a name="l00712"></a>00712                 <span class="comment">// Valid (non-fffffff) MAC addr</span>
<a name="l00713"></a>00713                 bad = 0;
<a name="l00714"></a>00714                 <span class="keywordflow">break</span>;
<a name="l00715"></a>00715             }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717         <span class="keywordflow">if</span> (bad)
<a name="l00718"></a>00718         {
<a name="l00719"></a>00719             <span class="comment">// create random MAC address and store it</span>
<a name="l00720"></a>00720             <a class="code" href="group__radio.html#g8382b61a38d3757b316352ddbe2b144b" title="Initialize the radio chip.">radioInit</a>(0); <span class="comment">// Needed for random to work.</span>
<a name="l00721"></a>00721             <a class="code" href="group__radio.html#g9c32d026c082234626f5f900077221bc" title="This function will change the current state of the radio transceiver&amp;#39;s internal...">radioSetTrxState</a>(<a class="code" href="group__radio__registers.html#g359db88bcffa6b39bdb64ec00ec3a1ae" title="Constant RX_ON for sub-register SR_TRX_STATUS.">RX_ON</a>);
<a name="l00722"></a>00722             <span class="keywordflow">for</span> (i=0;i&lt;8;i++)
<a name="l00723"></a>00723                 buf[i] = <a class="code" href="group__radio.html#g301044554e9d047bf22935d01c615884" title="Returns a random number, composed of bits from the radio&amp;#39;s random number generator...">radioRandom</a>(8);
<a name="l00724"></a>00724             halPutMacAddr(buf);
<a name="l00725"></a>00725         }
<a name="l00726"></a>00726 
<a name="l00727"></a>00727         halGetEeprom((u8*)offsetof(<a class="code" href="structtEepromContents.html" title="Locations in EEPROM of the stored data.">tEepromContents</a>, dataSeconds),
<a name="l00728"></a>00728                      <span class="keyword">sizeof</span>(typeof(((<a class="code" href="structtEepromContents.html" title="Locations in EEPROM of the stored data.">tEepromContents</a>*)0)-&gt;dataSeconds)),
<a name="l00729"></a>00729                      buf);
<a name="l00730"></a>00730         <span class="keywordflow">if</span> (*((u16*)buf) == 0xffff)
<a name="l00731"></a>00731         {
<a name="l00732"></a>00732             <span class="comment">// Bad timeout, set for 2 seconds</span>
<a name="l00733"></a>00733             *((u16*)buf) = 0x0014;
<a name="l00734"></a>00734             halPutEeprom((u8*)offsetof(<a class="code" href="structtEepromContents.html" title="Locations in EEPROM of the stored data.">tEepromContents</a>, dataSeconds),
<a name="l00735"></a>00735                          <span class="keyword">sizeof</span>(typeof(((<a class="code" href="structtEepromContents.html" title="Locations in EEPROM of the stored data.">tEepromContents</a>*)0)-&gt;dataSeconds)),
<a name="l00736"></a>00736                          buf);
<a name="l00737"></a>00737         }
<a name="l00738"></a>00738     <span class="comment">//}</span>
<a name="l00739"></a>00739 }
<a name="l00740"></a>00740 <span class="preprocessor">#endif // __AVR__</span>
<a name="l00741"></a>00741 <span class="preprocessor"></span>
<a name="l00746"></a><a class="code" href="group__app.html#g47ed1e535fd6629e5366687dbf036d23">00746</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g47ed1e535fd6629e5366687dbf036d23" title="Sample application function, which initializes the application.">appInit</a>(<span class="keywordtype">void</span>)
<a name="l00747"></a>00747 {
<a name="l00748"></a>00748     <span class="comment">// Init the mac</span>
<a name="l00749"></a>00749     LED_INIT();
<a name="l00750"></a>00750 
<a name="l00751"></a>00751     <span class="comment">// Blip the LED once on powerup</span>
<a name="l00752"></a>00752     blink1();
<a name="l00753"></a>00753 
<a name="l00754"></a>00754 <span class="preprocessor">#if (__AVR__)</span>
<a name="l00755"></a>00755 <span class="preprocessor"></span>    <span class="comment">// If the EEPROM is cleared, init it to something useful</span>
<a name="l00756"></a>00756     <a class="code" href="group__app.html#g786cdc3a3d24514299181bb559dceff3" title="Verifies that the EEPROM contains valid data for the stored MAC address.">checkEeprom</a>();
<a name="l00757"></a>00757 <span class="preprocessor">#endif // __AVR__</span>
<a name="l00758"></a>00758 <span class="preprocessor"></span>    <span class="comment">// Init the mac and stuff</span>
<a name="l00759"></a>00759     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l00760"></a>00760     {
<a name="l00761"></a>00761         <a class="code" href="group__mac__scan.html#g26cb107f1a13ba8b3ba4008d00eb6b54" title="This function is used by the coordinator to find a clear channel to use for the PAN...">macFindClearChannel</a>();
<a name="l00762"></a>00762         <span class="comment">// appClearChanFound() will be called</span>
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764     <span class="keywordflow">else</span>
<a name="l00765"></a>00765     {
<a name="l00766"></a>00766         debugMsgStr(<span class="stringliteral">"\r\nStartup, I am router/end."</span>);
<a name="l00767"></a>00767 
<a name="l00768"></a>00768         <span class="comment">// End node or router, start scanning for a coordinator</span>
<a name="l00769"></a>00769         <a class="code" href="group__app.html#g83f230018f0884c336002b3005395314" title="Example function, starts the network by scanning channels for a coordinator.">appStartScan</a>();
<a name="l00770"></a>00770         <span class="comment">// when scan is finished, appScanConfirm will be called.</span>
<a name="l00771"></a>00771 
<a name="l00772"></a>00772         <span class="keywordflow">if</span> (<a class="code" href="group__app.html#gfb4e3c89d60cf32cc974d72af22f5425" title="Enable or disable the IPV6/6LoWPAN layer by setting this macro to 1 (on) or 0 (off)...">IPV6LOWPAN</a> == 1)
<a name="l00773"></a>00773             sixlowpan_init();
<a name="l00774"></a>00774     }
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     <span class="comment">// Init the button</span>
<a name="l00777"></a>00777     BUTTON_SETUP();
<a name="l00778"></a>00778 
<a name="l00779"></a>00779     <span class="comment">// Turn the power down depending if button is pressed on powerup</span>
<a name="l00780"></a>00780     <span class="keywordflow">if</span> (!BUTTON_PRESSED() &amp;&amp; <a class="code" href="group__app.html#gd5c46706b38c7dc7ebb32e964a24fd13" title="The global demo flag.">DEMO</a>)
<a name="l00781"></a>00781     {
<a name="l00782"></a>00782 <span class="preprocessor">#if !TRACKDEMO</span>
<a name="l00783"></a>00783 <span class="preprocessor"></span>        <span class="comment">// Reduce power to lowest setting</span>
<a name="l00784"></a>00784         <span class="keywordflow">if</span>(<a class="code" href="group__radio.html#gb57e5c97e5d788f048284f1175c757b7" title="The BAND macro is set to one particular band based on which platform selected for...">BAND</a>==BAND900)
<a name="l00785"></a>00785             <a class="code" href="group__arm.html#g6e9e307a1b8e39fa9261ee12ced67314" title="This function writes a new value to one of the radio transceiver&amp;#39;s registers...">hal_register_write</a>(<a class="code" href="group__radio__registers.html#g102bbda4e4354e6c5d42d73a8202476d" title="Offset for register PHY_TX_PWR.">RG_PHY_TX_PWR</a>,0x06);
<a name="l00786"></a>00786         <span class="keywordflow">else</span>
<a name="l00787"></a>00787             <a class="code" href="group__radio.html#g304d72041bb3ee614ac9e5dd0f9cd2bc" title="This function will change the output power level.">radioSetTxPowerLevel</a>(TX_PWR_17_2DBM);
<a name="l00788"></a>00788 
<a name="l00789"></a>00789         <span class="comment">// Reduce sensitivity a lot.</span>
<a name="l00790"></a>00790         <a class="code" href="group__arm.html#g4e55279d2a68db6e6127b853baee2127" title="This function writes a new value to one of the radio transceiver&amp;#39;s subregisters...">hal_subregister_write</a>(<a class="code" href="group__radio__registers.html#gc288c78e0cf37d85b4bf008891bc98e8" title="Offset for sub-register RX_PDT_LEVEL.">SR_RX_PDT_LEVEL</a>, 0x02);
<a name="l00791"></a>00791 <span class="preprocessor">#endif</span>
<a name="l00792"></a>00792 <span class="preprocessor"></span>        debugMsgStr(<span class="stringliteral">"\r\nDemo mode"</span>);
<a name="l00793"></a>00793     }
<a name="l00794"></a>00794     <span class="keywordflow">else</span>
<a name="l00795"></a>00795         debugMsgStr(<span class="stringliteral">"\r\nNormal mode"</span>);
<a name="l00796"></a>00796 
<a name="l00797"></a>00797 }
<a name="l00798"></a>00798 
<a name="l00803"></a><a class="code" href="group__app.html#ga30f0284bb27faed7a9e27c5bd9e853a">00803</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#ga30f0284bb27faed7a9e27c5bd9e853a" title="Sample application function.">doPing</a>(<span class="keywordtype">void</span>)
<a name="l00804"></a>00804 {
<a name="l00805"></a>00805     <a class="code" href="group__arm.html#g6e9e307a1b8e39fa9261ee12ced67314" title="This function writes a new value to one of the radio transceiver&amp;#39;s registers...">hal_register_write</a>(<a class="code" href="group__radio__registers.html#g27a2452254bf5ec820d5f60254cc5c80" title="Offset for register CSMA_BE.">RG_CSMA_BE</a>,0);
<a name="l00806"></a>00806     <span class="comment">//macDataRequest(DEFAULT_COORD_ADDR, 110, dataString);</span>
<a name="l00807"></a>00807     <a class="code" href="group__mac__data.html#g7e4c5d07ec7a2622dabbcf51b1fe4ba9" title="Send a ping packet (either request or response) to another node.">macPing</a>(<a class="code" href="group__mac.html#g85ba6c45557eb0369e606452f9d902e6" title="Ping request frame.">PING_REQ_FRAME</a>, <a class="code" href="group__mac.html#gd24d249b0f426b8bd98a2180564531dc" title="The coordinator&amp;#39;s short address, always zero.">DEFAULT_COORD_ADDR</a>);
<a name="l00808"></a>00808 
<a name="l00809"></a>00809     <span class="comment">// Uncomment the next line to make the button unleash a torrent of pings</span>
<a name="l00810"></a>00810 <span class="preprocessor">#if __AVR__</span>
<a name="l00811"></a>00811 <span class="preprocessor"></span>    <span class="comment">//    pingTimer = macSetAlarm(5+(23*(BAND == BAND900)), doPing);</span>
<a name="l00812"></a>00812     pingTimer = <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(500, <a class="code" href="group__app.html#ga30f0284bb27faed7a9e27c5bd9e853a" title="Sample application function.">doPing</a>);
<a name="l00813"></a>00813 <span class="preprocessor">#endif</span>
<a name="l00814"></a>00814 <span class="preprocessor"></span>}
<a name="l00815"></a>00815 
<a name="l00819"></a><a class="code" href="group__app.html#g41510a26d416bb1f5c1833233468cf6c">00819</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g41510a26d416bb1f5c1833233468cf6c" title="This is used as the allNodes callback for repeating the function operation.">allNodesCB</a>(<span class="keywordtype">void</span>)
<a name="l00820"></a>00820 {
<a name="l00821"></a>00821     <a class="code" href="group__app.html#g294a39a42680ce725580f509c3ab692e" title="When called, this will either Ping or request data from all associated nodes.">allNodes</a>(0,0);
<a name="l00822"></a>00822 }
<a name="l00823"></a>00823 
<a name="l00828"></a><a class="code" href="group__sensors.html#g294a39a42680ce725580f509c3ab692e">00828</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g294a39a42680ce725580f509c3ab692e" title="When called, this will either Ping or request data from all associated nodes.">allNodes</a>(u8 func, u16 val)
<a name="l00829"></a>00829 {
<a name="l00830"></a>00830     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l00831"></a>00831     {
<a name="l00832"></a>00832         <span class="keyword">static</span> u8 nodeNdx = 0; <span class="comment">// Incremented each time through</span>
<a name="l00833"></a>00833         <span class="keyword">static</span> u8 function;
<a name="l00834"></a>00834         <span class="keyword">static</span> u16 value;
<a name="l00835"></a>00835         u8 nodeFound=0;
<a name="l00836"></a>00836         <a class="code" href="structassociatedNodes__t.html" title="This is the structure for each element of the table of the associated nodes.">associatedNodes_t</a> *node;
<a name="l00837"></a>00837 
<a name="l00838"></a>00838         <span class="comment">// Check to see if this is first time through</span>
<a name="l00839"></a>00839         <span class="keywordflow">if</span> (func)
<a name="l00840"></a>00840         {
<a name="l00841"></a>00841             <span class="comment">// Set up for repeated calls to this function</span>
<a name="l00842"></a>00842             function = func;
<a name="l00843"></a>00843             value = val;
<a name="l00844"></a>00844             nodeNdx = 1;
<a name="l00845"></a>00845         }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847         <span class="comment">// See if we are supposed to do something</span>
<a name="l00848"></a>00848         <span class="keywordflow">if</span> (!function)
<a name="l00849"></a>00849             <span class="keywordflow">return</span>;
<a name="l00850"></a>00850 
<a name="l00851"></a>00851         <span class="comment">// Get a node from table</span>
<a name="l00852"></a>00852         node = <a class="code" href="group__mac__associate.html#g553b1ee14bf13a99a122ff51176477fd" title="Gets one entry in the table of nodes.">macGetNode</a>(nodeNdx);
<a name="l00853"></a>00853 
<a name="l00854"></a>00854         <span class="comment">// Do the operation for connected nodes</span>
<a name="l00855"></a>00855         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="structassociatedNodes__t.html#00c2b0c5a9e3216e2b3e8eac93049bcb" title="Type of node, see COORD for types.">nodeType</a>)
<a name="l00856"></a>00856         {
<a name="l00857"></a>00857             nodeFound = 1;
<a name="l00858"></a>00858             <span class="comment">// Do the operation on it</span>
<a name="l00859"></a>00859             <span class="keywordflow">switch</span> (function)
<a name="l00860"></a>00860             {
<a name="l00861"></a>00861             <span class="keywordflow">case</span> PING_ALL:
<a name="l00862"></a>00862                 <span class="comment">// Send a ping to the node</span>
<a name="l00863"></a>00863                 debugMsgStr(<span class="stringliteral">"\r\nPinging node "</span>);
<a name="l00864"></a>00864                 debugMsgInt(nodeNdx);
<a name="l00865"></a>00865                 <a class="code" href="group__mac__data.html#g7e4c5d07ec7a2622dabbcf51b1fe4ba9" title="Send a ping packet (either request or response) to another node.">macPing</a>(<a class="code" href="group__mac.html#g85ba6c45557eb0369e606452f9d902e6" title="Ping request frame.">PING_REQ_FRAME</a>, nodeNdx);
<a name="l00866"></a>00866                 <span class="keywordflow">break</span>;
<a name="l00867"></a>00867             <span class="keywordflow">case</span> <a class="code" href="group__sensors.html#gaae5f0c0221a794b41194ff6eede970b" title="Support for changing all node&amp;#39;s interval response time.">REPORT_ALL</a>:
<a name="l00868"></a>00868                 <span class="comment">// Change report time</span>
<a name="l00869"></a>00869                 <span class="keywordflow">if</span> (APP==<a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a>)
<a name="l00870"></a>00870                 {
<a name="l00871"></a>00871                     debugMsgStr(<span class="stringliteral">"\r\nInterval node "</span>);
<a name="l00872"></a>00872                     debugMsgInt(nodeNdx);
<a name="l00873"></a>00873                     debugMsgStr(<span class="stringliteral">" = "</span>);
<a name="l00874"></a>00874                     debugMsgInt(value);
<a name="l00875"></a>00875                     <a class="code" href="group__sensors.html#g32bb0a72bd1635959ac4397db317edae" title="Request a reading from a sensor node.">sensorRequestReading</a>(nodeNdx, value);
<a name="l00876"></a>00876                 }
<a name="l00877"></a>00877                 <span class="keywordflow">break</span>;
<a name="l00878"></a>00878             }
<a name="l00879"></a>00879         }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881         <span class="comment">// Prepare for next node in the list</span>
<a name="l00882"></a>00882         nodeNdx++;
<a name="l00883"></a>00883         <span class="keywordflow">if</span> (nodeNdx &lt; MAXNODES)
<a name="l00884"></a>00884             <span class="comment">// Let's go again</span>
<a name="l00885"></a>00885             <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(nodeFound ? 250 : 1, <a class="code" href="group__app.html#g41510a26d416bb1f5c1833233468cf6c" title="This is used as the allNodes callback for repeating the function operation.">allNodesCB</a>);
<a name="l00886"></a>00886         <span class="keywordflow">else</span>
<a name="l00887"></a>00887             <span class="comment">// All done, cancel any furthur action</span>
<a name="l00888"></a>00888             function = value = 0;
<a name="l00889"></a>00889     }
<a name="l00890"></a>00890 }
<a name="l00891"></a>00891 
<a name="l00897"></a><a class="code" href="group__app.html#g2dbe1cf2d8881afe92c984d67cbf8656">00897</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g2dbe1cf2d8881afe92c984d67cbf8656" title="Print prompts for debug mode.">printPrompt</a>(<span class="keywordtype">void</span>)
<a name="l00898"></a>00898 {
<a name="l00899"></a>00899     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l00900"></a>00900     {
<a name="l00901"></a>00901 <span class="preprocessor">#if (__AVR__)</span>
<a name="l00902"></a>00902 <span class="preprocessor"></span>        debugMsgStr(<span class="stringliteral">"\r\nd=dump t=table i=info p=ping s=stream c=chan"</span>);
<a name="l00903"></a>00903         debugMsgStr(<span class="stringliteral">"\r\nr=reading n=name w=wake P=pause: "</span>);
<a name="l00904"></a>00904 <span class="preprocessor">#else // __arm__</span>
<a name="l00905"></a>00905 <span class="preprocessor"></span>        fnDebugMsg(<span class="stringliteral">"\r\n           802.15.4 Menu\r\n"</span>);
<a name="l00906"></a>00906         fnDebugMsg(<span class="stringliteral">"================================\r\n"</span>);
<a name="l00907"></a>00907         fnDebugMsg(<span class="stringliteral">"a.....IP address       A.....IPv6 Addresses\r\n"</span>);
<a name="l00908"></a>00908         fnDebugMsg(<span class="stringliteral">"b.....break            c.....chan\r\n"</span>);
<a name="l00909"></a>00909         fnDebugMsg(<span class="stringliteral">"C.....Calibration      d.....dump\r\n"</span>);
<a name="l00910"></a>00910         fnDebugMsg(<span class="stringliteral">"f.....filename         i.....info\r\n"</span>);
<a name="l00911"></a>00911         fnDebugMsg(<span class="stringliteral">"I.....New IP Addr      l.....log\r\n"</span>);
<a name="l00912"></a>00912         fnDebugMsg(<span class="stringliteral">"n.....name             o.....toggle readings\r\n"</span>);
<a name="l00913"></a>00913         fnDebugMsg(<span class="stringliteral">"p.....ping             Q.....Quit telnet\r\n"</span>);
<a name="l00914"></a>00914         fnDebugMsg(<span class="stringliteral">"r.....read interval    t.....table\r\n"</span>);
<a name="l00915"></a>00915         fnDebugMsg(<span class="stringliteral">"T.....Touch            w.....wake\r\n"</span>);
<a name="l00916"></a>00916         fnDebugMsg(<span class="stringliteral">"X.....Max TX power\r\n"</span>);
<a name="l00917"></a>00917         fnDebugMsg(<span class="stringliteral">"&gt; "</span>);
<a name="l00918"></a>00918 <span class="preprocessor">#endif // __AVR__</span>
<a name="l00919"></a>00919 <span class="preprocessor"></span>    }
<a name="l00920"></a>00920     <span class="keywordflow">else</span>
<a name="l00921"></a>00921         debugMsgStr(<span class="stringliteral">"\r\nd=dump t=table i=info p=ping s=stream P=pause: "</span>);
<a name="l00922"></a>00922 }
<a name="l00923"></a>00923 
<a name="l00924"></a>00924 <span class="preprocessor">#if __AVR__</span>
<a name="l00925"></a>00925 <span class="preprocessor"></span><span class="preprocessor">#define sicslowpan_hc01_gen_rs()</span>
<a name="l00926"></a>00926 <span class="preprocessor"></span>
<a name="l00932"></a><a class="code" href="group__app.html#g0b12d03da74adb585dc8600038837f15">00932</a> <span class="keywordtype">void</span> <a class="code" href="group__app.html#g0b12d03da74adb585dc8600038837f15" title="Sample application task loop function.">appTask</a>(<span class="keywordtype">void</span>)
<a name="l00933"></a>00933 {
<a name="l00934"></a>00934     <span class="keyword">static</span> u8 state=0;             <span class="comment">// Used for button processing</span>
<a name="l00935"></a>00935 
<a name="l00936"></a>00936     <span class="comment">// perform periodical things.</span>
<a name="l00937"></a>00937     <span class="comment">// check for button presses on RCB's</span>
<a name="l00938"></a>00938     <span class="keywordflow">if</span> (BUTTON_PRESSED() ||
<a name="l00939"></a>00939         (simulateButton &amp;&amp;
<a name="l00940"></a>00940          <a class="code" href="group__app.html#gfb4e3c89d60cf32cc974d72af22f5425" title="Enable or disable the IPV6/6LoWPAN layer by setting this macro to 1 (on) or 0 (off)...">IPV6LOWPAN</a> == 1 &amp;&amp;
<a name="l00941"></a>00941          <a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> != <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>))
<a name="l00942"></a>00942     {
<a name="l00943"></a>00943         <span class="keywordflow">if</span> (!state)
<a name="l00944"></a>00944         {
<a name="l00945"></a>00945             <span class="keywordflow">if</span> (pingTimer)
<a name="l00946"></a>00946             {
<a name="l00947"></a>00947                 <span class="comment">// stop pinging</span>
<a name="l00948"></a>00948                 <a class="code" href="group__timer__module.html#g424100b5b43a9d709cec3d509ef6f48c" title="End the timer specified by ID, before it is expired.">macTimerEnd</a>(pingTimer);
<a name="l00949"></a>00949                 pingTimer = 0;
<a name="l00950"></a>00950             }
<a name="l00951"></a>00951             <span class="keywordflow">else</span>
<a name="l00952"></a>00952             {
<a name="l00953"></a>00953                 <span class="comment">// ping the coordinator</span>
<a name="l00954"></a>00954                 debugMsgStr(<span class="stringliteral">"\r\nPinging coord\r\n"</span>);
<a name="l00955"></a>00955                 <span class="keywordflow">if</span> (<a class="code" href="group__app.html#gfb4e3c89d60cf32cc974d72af22f5425" title="Enable or disable the IPV6/6LoWPAN layer by setting this macro to 1 (on) or 0 (off)...">IPV6LOWPAN</a> == 1)
<a name="l00956"></a>00956                 {
<a name="l00957"></a>00957                     simulateButton = 0;
<a name="l00958"></a>00958                     <a class="code" href="group__app.html#g9b846160a17878fbb5a2a93137917d07" title="Called when button on physical device is pressed, or a command to simulate pressing...">sixlowpan_button</a>();
<a name="l00959"></a>00959                 }
<a name="l00960"></a>00960                 <span class="keywordflow">else</span>
<a name="l00961"></a>00961                 <a class="code" href="group__app.html#ga30f0284bb27faed7a9e27c5bd9e853a" title="Sample application function.">doPing</a>();
<a name="l00962"></a>00962             }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964             state = 1;
<a name="l00965"></a>00965         }
<a name="l00966"></a>00966     }
<a name="l00967"></a>00967     <span class="keywordflow">else</span>
<a name="l00968"></a>00968         state = 0;
<a name="l00969"></a>00969 
<a name="l00970"></a>00970     <span class="keywordflow">if</span> (<a class="code" href="group__app.html#gd72dbcf6d0153db1b8d8a58001feed83" title="The global debugging flag.">DEBUG</a> &amp;&amp; <a class="code" href="group__serial.html#gae3f0b4211ba45d265973d40ccbb5fd1" title="Flag to enable the serial port.">SERIAL</a>)
<a name="l00971"></a>00971     {
<a name="l00972"></a>00972         <span class="keywordflow">if</span> (<a class="code" href="group__serial.html#g46a01c0d9f12d9deaf905f76463175ac" title="Check to see if any characters are waiting in the serial input buffer.">serial_ischar</a>() &amp;&amp;
<a name="l00973"></a>00973             (APP != <a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a> || !<a class="code" href="group__sensors.html#g38d09386a3cbf1fa2e8296db204f1fdb" title="Returns true if the node is engaged in a calibration process.">sensorCalBusy</a>()))
<a name="l00974"></a>00974         {
<a name="l00975"></a>00975             u8 n;
<a name="l00976"></a>00976             <span class="keywordtype">char</span> ch;
<a name="l00977"></a>00977             <span class="keyword">static</span> u16 addr=0;
<a name="l00978"></a>00978             <span class="keywordtype">char</span> str[102];
<a name="l00979"></a>00979 
<a name="l00980"></a>00980             <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#41e5b4ad93b57a3da564efa92e72a909" title="Is the mac busy? Used to protect mac_buffer_tx.">busy</a>)
<a name="l00981"></a>00981                 <span class="comment">// try again when mac is not busy</span>
<a name="l00982"></a>00982                 <span class="keywordflow">return</span>;
<a name="l00983"></a>00983 
<a name="l00984"></a>00984             ch = <a class="code" href="group__serial.html#g4b0fa10a931750ad29deb068cfd1e54b" title="Returns a character from the serial port.">serial_getchar</a>();
<a name="l00985"></a>00985             <span class="comment">// Quit stream mode on Ctrl-t</span>
<a name="l00986"></a>00986             <span class="keywordflow">if</span> (ch == 0x14)
<a name="l00987"></a>00987                 streamMode = 0;
<a name="l00988"></a>00988             <span class="comment">// In stream mode, send all serial data over the air.</span>
<a name="l00989"></a>00989             <span class="keywordflow">if</span> (streamMode)
<a name="l00990"></a>00990             {
<a name="l00991"></a>00991                 <span class="comment">// Send the chars out over the air to dest</span>
<a name="l00992"></a>00992                 n = 0;
<a name="l00993"></a>00993                 <span class="keywordflow">for</span>(;;)
<a name="l00994"></a>00994                 {
<a name="l00995"></a>00995                     <span class="comment">// Build a string of chars waiting in the queue</span>
<a name="l00996"></a>00996                     str[n++] = ch;
<a name="l00997"></a>00997                     <span class="keywordflow">if</span> (n &gt;= 100)
<a name="l00998"></a>00998                         <span class="keywordflow">break</span>;
<a name="l00999"></a>00999                     <span class="keywordflow">if</span> (<a class="code" href="group__serial.html#g46a01c0d9f12d9deaf905f76463175ac" title="Check to see if any characters are waiting in the serial input buffer.">serial_ischar</a>())
<a name="l01000"></a>01000                         ch = <a class="code" href="group__serial.html#g4b0fa10a931750ad29deb068cfd1e54b" title="Returns a character from the serial port.">serial_getchar</a>();
<a name="l01001"></a>01001                     <span class="keywordflow">else</span>
<a name="l01002"></a>01002                         <span class="keywordflow">break</span>;
<a name="l01003"></a>01003                 }
<a name="l01004"></a>01004                 <span class="comment">// And send it off to destination</span>
<a name="l01005"></a>01005                 <a class="code" href="group__mac__data.html#g57df637c21a2060c49e6e19c09b38d30" title="The macsixlowpanDataRequest function is used to send a frame over the air to another...">macDataRequest</a>(addr, n, (u8*) str);
<a name="l01006"></a>01006             }
<a name="l01007"></a>01007             <span class="keywordflow">else</span>
<a name="l01008"></a>01008             {
<a name="l01009"></a>01009                 debugMsgCrLf();
<a name="l01010"></a>01010                 <span class="keywordflow">switch</span> (ch)
<a name="l01011"></a>01011                 {
<a name="l01012"></a>01012                 <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
<a name="l01013"></a>01013                     <span class="comment">// reg dump</span>
<a name="l01014"></a>01014                     <a class="code" href="group__app.html#g73d2d3a9fcc954b754974d35bbd85011" title="Dumps the RF2xx register contents to serial port.">rf2xx_reg_dump</a>();
<a name="l01015"></a>01015                     <span class="keywordflow">break</span>;
<a name="l01016"></a>01016                 <span class="keywordflow">case</span> <span class="charliteral">'t'</span>:
<a name="l01017"></a>01017                     <span class="comment">// print table</span>
<a name="l01018"></a>01018                     <a class="code" href="group__mac__associate.html#g2d350a06c929bb4d5001b2f10635f22e" title="Print the network tree in a semi-graphical format, to be viewed on a terminal screen...">macPrintTree</a>();
<a name="l01019"></a>01019                     <span class="keywordflow">break</span>;
<a name="l01020"></a>01020                 <span class="keywordflow">case</span> <span class="charliteral">'i'</span>:
<a name="l01021"></a>01021                     <span class="comment">// print info</span>
<a name="l01022"></a>01022                     sprintf(str,<span class="stringliteral">"\r\nshort = %04X\r\nparent = %04X\r\nroute=%04X\r\n"</span>,
<a name="l01023"></a>01023                             <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#410a3539e6e06a2192ef87dfe7ae7424" title="The short address for this node.">shortAddress</a>,
<a name="l01024"></a>01024                             <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#8746018dfd92c5ea8b5dcd12e89dd767" title="The short address of the parent&amp;#39;s node.">parentShortAddress</a>,
<a name="l01025"></a>01025                             <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#ec94dfe288c1f08ea35cdfb34cc518a0" title="Last address we sent a routed packet to.">lastRoute</a>);
<a name="l01026"></a>01026                     debugMsgStr(str);
<a name="l01027"></a>01027                     sprintf(str,<span class="stringliteral">"chan = %d\r\n"</span>, <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#b18607f3692130bb3da0510749eaeb78" title="The channel number this node is operating on.">currentChannel</a>);
<a name="l01028"></a>01028                     debugMsgStr(str);
<a name="l01029"></a>01029                     debugMsgStr(<span class="stringliteral">"PAN ID = 0x"</span>);
<a name="l01030"></a>01030                     debugMsgHex(<a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#0661aa4bcc924815144446db68168a1f" title="The PAN ID for the network this node is associated with.">panId</a>);
<a name="l01031"></a>01031                     debugMsgCrLf();
<a name="l01032"></a>01032                     u32 low = <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#7d51df5f7f61e72d42e006e9ca6cf8ce" title="Long (MAC) address of this node.">longAddr</a>;
<a name="l01033"></a>01033                     u32 high = <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#7d51df5f7f61e72d42e006e9ca6cf8ce" title="Long (MAC) address of this node.">longAddr</a> &gt;&gt; 32;
<a name="l01034"></a>01034                     sprintf(str,<span class="stringliteral">"long = 0x%08lX%08lX\r\n"</span>, high, low);
<a name="l01035"></a>01035                     debugMsgStr(str);
<a name="l01036"></a>01036 
<a name="l01037"></a>01037                     sprintf(str,<span class="stringliteral">"assoc = %s\r\nHops = %04X\r\n"</span>,
<a name="l01038"></a>01038                             <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#b90d9d43eb3ae9d98e9cd556272bf464" title="Is this node associated with a network?">associated</a> ? <span class="stringliteral">"true"</span> : <span class="stringliteral">"false"</span>,
<a name="l01039"></a>01039                             <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#33aa707181985abbf83a6bcaa8537009" title="Number of hops from this node to the coordinator.">hopsToCoord</a>);
<a name="l01040"></a>01040                     debugMsgStr(str);
<a name="l01041"></a>01041                     sprintf(str,<span class="stringliteral">"rand = %02X\r\n"</span>,
<a name="l01042"></a>01042                             <a class="code" href="group__radio.html#g301044554e9d047bf22935d01c615884" title="Returns a random number, composed of bits from the radio&amp;#39;s random number generator...">radioRandom</a>(8));
<a name="l01043"></a>01043                     debugMsgStr(str);
<a name="l01044"></a>01044                     <span class="comment">// Radio part number</span>
<a name="l01045"></a>01045                     u16 pn = <a class="code" href="group__radio.html#g2976f50bf538933d7eba0444494d6289" title="Returns the radio part number.">radioGetPartnum</a>();
<a name="l01046"></a>01046                     <span class="keywordflow">switch</span> (pn)
<a name="l01047"></a>01047                     {
<a name="l01048"></a>01048                     <span class="keywordflow">case</span> <a class="code" href="group__radio__registers.html#g4f0b9bf26fdc64cc5e6c640871b050e4" title="Value for AT86RF230.">RF230</a>:
<a name="l01049"></a>01049                         pn = 230;
<a name="l01050"></a>01050                         <span class="keywordflow">break</span>;
<a name="l01051"></a>01051                     <span class="keywordflow">case</span> <a class="code" href="group__radio__registers.html#g5de4d4c246844ae9e84c535b3dc19dde" title="Value for AT86RF231.">RF231</a>:
<a name="l01052"></a>01052                         pn = 231;
<a name="l01053"></a>01053                         <span class="keywordflow">break</span>;
<a name="l01054"></a>01054                     <span class="keywordflow">case</span> <a class="code" href="group__radio__registers.html#ge7fc76de2ff765e0a0ee7273e2f3ec45" title="Value for AT86RF212.">RF212</a>:
<a name="l01055"></a>01055                         pn = 212;
<a name="l01056"></a>01056                         <span class="keywordflow">break</span>;
<a name="l01057"></a>01057                     <span class="keywordflow">default</span>:
<a name="l01058"></a>01058                         <span class="comment">// Just report whatever number the radio chip gives.</span>
<a name="l01059"></a>01059                         <span class="keywordflow">break</span>;
<a name="l01060"></a>01060                     }
<a name="l01061"></a>01061                     debugMsgStr(<span class="stringliteral">"Part=RF"</span>);
<a name="l01062"></a>01062                     sprintf(str,<span class="stringliteral">"%u, Rev=%d\r\n"</span>, pn,
<a name="l01063"></a>01063                             <a class="code" href="group__arm.html#gfd58b0cad5bbd45b1c4a8d30be4bc11c" title="This function reads data from one of the radio transceiver&amp;#39;s registers.">hal_register_read</a>(<a class="code" href="group__radio__registers.html#gc1888aaec44899f2a3d7856b757533e8" title="Offset for register VERSION_NUM.">RG_VERSION_NUM</a>));
<a name="l01064"></a>01064                     debugMsgStr(str);
<a name="l01065"></a>01065                     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> != <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a> &amp;&amp; APP == <a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a>)
<a name="l01066"></a>01066                     {
<a name="l01067"></a>01067                         debugMsgStr(<span class="stringliteral">"Name="</span>);
<a name="l01068"></a>01068                         debugMsgStr(<a class="code" href="group__sensors.html#g4320310b6bca7d1d72e8e3abc56bc348" title="Returns a pointer to the name of this node.">sensorGetName</a>());
<a name="l01069"></a>01069                         debugMsgCrLf();
<a name="l01070"></a>01070                     }
<a name="l01071"></a>01071                     <span class="comment">// Report compile options</span>
<a name="l01072"></a>01072                     sprintf(str,<span class="stringliteral">"Sleep = %s\r\n"</span>, <a class="code" href="group__app.html#g7a52419b3bc2a1c7763ace68f3f172fb" title="Enable or disable the sleep function by setting this macro to 1 (on) or 0 (off).">RUMSLEEP</a> ? <span class="stringliteral">"Yes"</span>:<span class="stringliteral">"No"</span>);
<a name="l01073"></a>01073                     debugMsgStr(str);
<a name="l01074"></a>01074                     sprintf(str,<span class="stringliteral">"Freq = %dMHz\r\n"</span>, (<span class="keywordtype">int</span>)(F_CPU / 1000000UL));
<a name="l01075"></a>01075                     debugMsgStr(str);
<a name="l01076"></a>01076                     <span class="keywordflow">if</span> (APP == <a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a>)
<a name="l01077"></a>01077                     {
<a name="l01078"></a>01078                         sprintf(str,<span class="stringliteral">"Interval = %d.%dsec\r\n"</span>, <a class="code" href="group__sensors.html#g8b30ebe0133dac95776ec6431d889f7e" title="Data interval setting. This is the time between frames in 1/10&amp;#39;s of a second...">frameInterval</a>/10, <a class="code" href="group__sensors.html#g8b30ebe0133dac95776ec6431d889f7e" title="Data interval setting. This is the time between frames in 1/10&amp;#39;s of a second...">frameInterval</a>%10);
<a name="l01079"></a>01079                         debugMsgStr(str);
<a name="l01080"></a>01080                         sprintf(str,<span class="stringliteral">"Sleep timed by %s timer\r\n"</span>, <a class="code" href="group__sleep.html#g14ae199e1518c5cdc08368fd78d6a437" title="Set this parameter to use the watchdog timer rather than the RTC oscillator for sleep...">WDOG_SLEEP</a> ? <span class="stringliteral">"WatchDog"</span> : <span class="stringliteral">"32KHz"</span>);
<a name="l01081"></a>01081                         debugMsgStr(str);
<a name="l01082"></a>01082                     }
<a name="l01083"></a>01083                     sprintf(str,<span class="stringliteral">"6LoWPAN = %s\r\n"</span>, <a class="code" href="group__app.html#gfb4e3c89d60cf32cc974d72af22f5425" title="Enable or disable the IPV6/6LoWPAN layer by setting this macro to 1 (on) or 0 (off)...">IPV6LOWPAN</a> ? <span class="stringliteral">"Yes"</span>:<span class="stringliteral">"No"</span>);
<a name="l01084"></a>01084                     debugMsgStr(str);
<a name="l01085"></a>01085                     sprintf(str,<span class="stringliteral">"Demo mode = %s\r\n"</span>, <a class="code" href="group__app.html#gd5c46706b38c7dc7ebb32e964a24fd13" title="The global demo flag.">DEMO</a> ? <span class="stringliteral">"Yes"</span>:<span class="stringliteral">"No"</span>);
<a name="l01086"></a>01086                     <span class="keywordflow">break</span>;
<a name="l01087"></a>01087                 <span class="keywordflow">case</span> <span class="charliteral">'p'</span>:
<a name="l01088"></a>01088                     <span class="comment">// ping</span>
<a name="l01089"></a>01089                     debugMsgStr(<span class="stringliteral">"\r\nEnter short addr:"</span>);
<a name="l01090"></a>01090                     <a class="code" href="group__serial.html#gc0ee16939b4816b2ca3bb093c6891739" title="Captures a string from serial port.">serial_gets</a>(str, 50, <span class="keyword">true</span>);
<a name="l01091"></a>01091                     addr = atoi(str);
<a name="l01092"></a>01092                     <a class="code" href="group__mac__data.html#g7e4c5d07ec7a2622dabbcf51b1fe4ba9" title="Send a ping packet (either request or response) to another node.">macPing</a>(<a class="code" href="group__mac.html#g85ba6c45557eb0369e606452f9d902e6" title="Ping request frame.">PING_REQ_FRAME</a>, addr);
<a name="l01093"></a>01093                     <span class="keywordflow">break</span>;
<a name="l01094"></a>01094                 <span class="keywordflow">case</span> <span class="charliteral">'s'</span>:
<a name="l01095"></a>01095                     <span class="comment">// Send data stream</span>
<a name="l01096"></a>01096                     debugMsgStr(<span class="stringliteral">"\r\nStream mode to addr:"</span>);
<a name="l01097"></a>01097                     <a class="code" href="group__serial.html#gc0ee16939b4816b2ca3bb093c6891739" title="Captures a string from serial port.">serial_gets</a>(str,50,<span class="keyword">true</span>);
<a name="l01098"></a>01098                     addr = atoi(str);
<a name="l01099"></a>01099                     streamMode = 1;
<a name="l01100"></a>01100                     <span class="keywordflow">break</span>;
<a name="l01101"></a>01101                 <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
<a name="l01102"></a>01102                     <span class="comment">// change coordinator channel</span>
<a name="l01103"></a>01103                     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l01104"></a>01104                     {
<a name="l01105"></a>01105                         debugMsgStr(<span class="stringliteral">"\r\nEnter new chan"</span>);
<a name="l01106"></a>01106                         <a class="code" href="group__serial.html#gc0ee16939b4816b2ca3bb093c6891739" title="Captures a string from serial port.">serial_gets</a>(str, 50, <span class="keyword">true</span>);
<a name="l01107"></a>01107                         ch = atoi(str);
<a name="l01108"></a>01108                         debugMsgStr(<span class="stringliteral">"\r\nEnter new PANID"</span>);
<a name="l01109"></a>01109                         <a class="code" href="group__serial.html#gc0ee16939b4816b2ca3bb093c6891739" title="Captures a string from serial port.">serial_gets</a>(str, 50, <span class="keyword">true</span>);
<a name="l01110"></a>01110 
<a name="l01111"></a>01111                         <span class="comment">// Re-do the init stuff.</span>
<a name="l01112"></a>01112                         <a class="code" href="group__mac.html#gaa0748a32ee5741afc6a5078d92158bb" title="Init the mac, which includes initializing the radio chip.">macInit</a>(ch);
<a name="l01113"></a>01113                         <a class="code" href="group__mac.html#gd9b6aa9e3aa0f562f49354f26bbf56ba" title="This function will cause a device to become a PAN Coordinator.">macStartCoord</a>();
<a name="l01114"></a>01114                         debugMsgStr(<span class="stringliteral">"\r\nStartup, I am coordinator.\r\n"</span>);
<a name="l01115"></a>01115                         <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#b90d9d43eb3ae9d98e9cd556272bf464" title="Is this node associated with a network?">associated</a> = <span class="keyword">true</span>;
<a name="l01116"></a>01116 
<a name="l01117"></a>01117                         <span class="comment">// Set PANID</span>
<a name="l01118"></a>01118                         addr = atoi(str);
<a name="l01119"></a>01119                         <span class="keywordflow">if</span> (addr)
<a name="l01120"></a>01120                         {
<a name="l01121"></a>01121                             <a class="code" href="group__radio.html#g8480a533bb1ba14171147bc1aeb78c7d" title="This function will set the PANID used by the address filter.">radioSetPanId</a>(addr);
<a name="l01122"></a>01122                             <a class="code" href="group__mac.html#g495ae4288ec139138c9ca2b8de136245" title="MAC config struct, contains state info for the MAC.">macConfig</a>.<a class="code" href="structmacConfig__t.html#0661aa4bcc924815144446db68168a1f" title="The PAN ID for the network this node is associated with.">panId</a> = addr;
<a name="l01123"></a>01123                         }
<a name="l01124"></a>01124                     }
<a name="l01125"></a>01125                     <span class="keywordflow">break</span>;
<a name="l01126"></a>01126                 <span class="keywordflow">case</span> <span class="charliteral">'r'</span>:
<a name="l01127"></a>01127                     <span class="comment">// Request reading from end node</span>
<a name="l01128"></a>01128                     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a> &amp;&amp; APP == <a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a>)
<a name="l01129"></a>01129                     {
<a name="l01130"></a>01130                         <span class="comment">// get address and time</span>
<a name="l01131"></a>01131                         debugMsgStr(<span class="stringliteral">"\r\nRequest data from node:"</span>);
<a name="l01132"></a>01132                         <a class="code" href="group__serial.html#gc0ee16939b4816b2ca3bb093c6891739" title="Captures a string from serial port.">serial_gets</a>(str,50,<span class="keyword">true</span>);
<a name="l01133"></a>01133                         addr = atoi(str);
<a name="l01134"></a>01134                         u16 time;
<a name="l01135"></a>01135                         debugMsgStr(<span class="stringliteral">"\r\nReport time (100mS intervals):"</span>);
<a name="l01136"></a>01136                         <a class="code" href="group__serial.html#gc0ee16939b4816b2ca3bb093c6891739" title="Captures a string from serial port.">serial_gets</a>(str,50,<span class="keyword">true</span>);
<a name="l01137"></a>01137                         time = atoi(str);
<a name="l01138"></a>01138                         <span class="comment">// Grab pending frames, so we don't trigger sending req frame</span>
<a name="l01139"></a>01139                         <a class="code" href="group__mac__event.html#g9b4bd3c99bd01a997dfbf36de2db14ae" title="This is the main loop task for the MAC.">macTask</a>();
<a name="l01140"></a>01140                         <a class="code" href="group__sensors.html#g32bb0a72bd1635959ac4397db317edae" title="Request a reading from a sensor node.">sensorRequestReading</a>(addr, time);
<a name="l01141"></a>01141                     }
<a name="l01142"></a>01142                     <span class="keywordflow">break</span>;
<a name="l01143"></a>01143                 <span class="keywordflow">case</span> <span class="charliteral">'C'</span>:
<a name="l01144"></a>01144                     <span class="comment">// calibrate an end node</span>
<a name="l01145"></a>01145                     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a> &amp;&amp; APP == <a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a>)
<a name="l01146"></a>01146                     {
<a name="l01147"></a>01147                         <span class="comment">// get address of node</span>
<a name="l01148"></a>01148                         debugMsgStr(<span class="stringliteral">"\r\nCal which node:"</span>);
<a name="l01149"></a>01149                         <a class="code" href="group__serial.html#gc0ee16939b4816b2ca3bb093c6891739" title="Captures a string from serial port.">serial_gets</a>(str,50,<span class="keyword">true</span>);
<a name="l01150"></a>01150                         addr = atoi(str);
<a name="l01151"></a>01151 
<a name="l01152"></a>01152                         <span class="comment">// Get cal info from node</span>
<a name="l01153"></a>01153                         <a class="code" href="group__sensors.html#g7be640146ea956f71c4540c1b247567c" title="Request an end node to send its calibration information.">sensorRequestCalInfo</a>(addr);
<a name="l01154"></a>01154                     }
<a name="l01155"></a>01155                     <span class="keywordflow">break</span>;
<a name="l01156"></a>01156                 <span class="keywordflow">case</span> <span class="charliteral">'S'</span>:
<a name="l01157"></a>01157                     <span class="comment">// sleep</span>
<a name="l01158"></a>01158                     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> != <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l01159"></a>01159                     {
<a name="l01160"></a>01160                         <span class="keywordflow">for</span>(;;)
<a name="l01161"></a>01161                         {
<a name="l01162"></a>01162                             u8 count;
<a name="l01163"></a>01163                             <a class="code" href="group__sleep.html#g93b5cdc0c2f6e617c9e63fac53cc8271" title="Put the node to sleep.">nodeSleep</a>(20);
<a name="l01164"></a>01164                             <a class="code" href="group__mac__data.html#g7e4c5d07ec7a2622dabbcf51b1fe4ba9" title="Send a ping packet (either request or response) to another node.">macPing</a>(<a class="code" href="group__mac.html#g85ba6c45557eb0369e606452f9d902e6" title="Ping request frame.">PING_REQ_FRAME</a>, <a class="code" href="group__mac.html#gd24d249b0f426b8bd98a2180564531dc" title="The coordinator&amp;#39;s short address, always zero.">DEFAULT_COORD_ADDR</a>);
<a name="l01165"></a>01165                             <span class="comment">// Get the ping response before going back to sleep</span>
<a name="l01166"></a>01166                             delay_us(6000);
<a name="l01167"></a>01167                             <span class="keywordflow">for</span> (count=0;count&lt;100;count++)
<a name="l01168"></a>01168                                 <a class="code" href="group__mac__event.html#g9b4bd3c99bd01a997dfbf36de2db14ae" title="This is the main loop task for the MAC.">macTask</a>();
<a name="l01169"></a>01169                             <span class="comment">// Send out the response string</span>
<a name="l01170"></a>01170                             delay_us(1000);
<a name="l01171"></a>01171                         }
<a name="l01172"></a>01172                     }
<a name="l01173"></a>01173                     <span class="keywordflow">break</span>;
<a name="l01174"></a>01174                 <span class="keywordflow">case</span> <span class="charliteral">'n'</span>:
<a name="l01175"></a>01175                     <span class="comment">// Name a node</span>
<a name="l01176"></a>01176                     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a> &amp;&amp; APP == <a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a>)
<a name="l01177"></a>01177                     {
<a name="l01178"></a>01178                         debugMsgStr(<span class="stringliteral">"\r\nName which node:"</span>);
<a name="l01179"></a>01179                         <a class="code" href="group__serial.html#gc0ee16939b4816b2ca3bb093c6891739" title="Captures a string from serial port.">serial_gets</a>(str,50,<span class="keyword">true</span>);
<a name="l01180"></a>01180                         addr = atoi(str);
<a name="l01181"></a>01181                         debugMsgStr(<span class="stringliteral">"\r\nEnter name:"</span>);
<a name="l01182"></a>01182                         <a class="code" href="group__serial.html#gc0ee16939b4816b2ca3bb093c6891739" title="Captures a string from serial port.">serial_gets</a>(str,50,<span class="keyword">true</span>);
<a name="l01183"></a>01183                         <a class="code" href="group__sensors.html#g0717b6140ef26cb1daa46ac31113f034" title="Set the name of the sensor name.">sensorSendSetNodeName</a>(addr, str);
<a name="l01184"></a>01184                     }
<a name="l01185"></a>01185                     <span class="keywordflow">break</span>;
<a name="l01186"></a>01186                 <span class="keywordflow">case</span> <span class="charliteral">'w'</span>:
<a name="l01187"></a>01187                     <span class="comment">// wake an end node</span>
<a name="l01188"></a>01188                     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l01189"></a>01189                     {
<a name="l01190"></a>01190                         debugMsgStr(<span class="stringliteral">"\r\nWake which node:"</span>);
<a name="l01191"></a>01191                         <a class="code" href="group__serial.html#gc0ee16939b4816b2ca3bb093c6891739" title="Captures a string from serial port.">serial_gets</a>(str,50,<span class="keyword">true</span>);
<a name="l01192"></a>01192                         addr = atoi(str);
<a name="l01193"></a>01193                         <span class="comment">// Must process any rx'd packets before running macWake...</span>
<a name="l01194"></a>01194                         <a class="code" href="group__mac__event.html#g9b4bd3c99bd01a997dfbf36de2db14ae" title="This is the main loop task for the MAC.">macTask</a>();
<a name="l01195"></a>01195                         <a class="code" href="group__mac__associate.html#g243906ca038a1601687f0aa66aa63973" title="Set a child node&amp;#39;s entry to be woken up.">macWakeChildNode</a>(addr);
<a name="l01196"></a>01196                     }
<a name="l01197"></a>01197                     <span class="keywordflow">break</span>;
<a name="l01198"></a>01198                 <span class="keywordflow">case</span> <span class="charliteral">'P'</span>:
<a name="l01199"></a>01199                     <span class="comment">// Pause serial display</span>
<a name="l01200"></a>01200                     debugMsgStr(<span class="stringliteral">"\r\nPaused, press 'P' to unpause"</span>);
<a name="l01201"></a>01201                     <a class="code" href="group__serial.html#gb684f2b6a9a5986085cf874eec04c2d6" title="Toggles the pause flag.">serial_toggle_pause</a>();
<a name="l01202"></a>01202                     <span class="keywordflow">break</span>;
<a name="l01203"></a>01203                 <span class="keywordflow">case</span> <span class="charliteral">'A'</span>:
<a name="l01204"></a>01204                     <span class="comment">// Do something to all nodes</span>
<a name="l01205"></a>01205                     <span class="keywordflow">if</span> (<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)
<a name="l01206"></a>01206                     {
<a name="l01207"></a>01207                         debugMsgStr(<span class="stringliteral">"\r\nAll nodes - (r)eading, (p)ping:"</span>);
<a name="l01208"></a>01208                         <a class="code" href="group__serial.html#gc0ee16939b4816b2ca3bb093c6891739" title="Captures a string from serial port.">serial_gets</a>(str,50,<span class="keyword">true</span>);
<a name="l01209"></a>01209                         <span class="comment">// Do the function</span>
<a name="l01210"></a>01210                         <span class="keywordflow">if</span> (*str == <span class="charliteral">'p'</span>)
<a name="l01211"></a>01211                             <a class="code" href="group__app.html#g294a39a42680ce725580f509c3ab692e" title="When called, this will either Ping or request data from all associated nodes.">allNodes</a>(PING_ALL,0);
<a name="l01212"></a>01212                         <span class="keywordflow">if</span> (*str == <span class="charliteral">'r'</span> &amp;&amp; APP == <a class="code" href="group__app.html#g84f1ead330bbcc83a63929c4726080d7" title="Macro to define the sensor application.">SENSOR</a>)
<a name="l01213"></a>01213                         {
<a name="l01214"></a>01214                             debugMsgStr(<span class="stringliteral">"\r\nReport time (100mS intervals):"</span>);
<a name="l01215"></a>01215                             <a class="code" href="group__serial.html#gc0ee16939b4816b2ca3bb093c6891739" title="Captures a string from serial port.">serial_gets</a>(str,50,<span class="keyword">true</span>);
<a name="l01216"></a>01216                             <a class="code" href="group__app.html#g294a39a42680ce725580f509c3ab692e" title="When called, this will either Ping or request data from all associated nodes.">allNodes</a>(<a class="code" href="group__sensors.html#gaae5f0c0221a794b41194ff6eede970b" title="Support for changing all node&amp;#39;s interval response time.">REPORT_ALL</a>, atoi(str));
<a name="l01217"></a>01217                         }
<a name="l01218"></a>01218                     }
<a name="l01219"></a>01219                     <span class="keywordflow">break</span>;
<a name="l01220"></a>01220                 <span class="keywordflow">default</span>:
<a name="l01221"></a>01221                     <span class="keywordflow">break</span>;
<a name="l01222"></a>01222                 }
<a name="l01223"></a>01223                 <span class="comment">// Delay a bit to allow for other messages (ping resp) to print.</span>
<a name="l01224"></a>01224                 <a class="code" href="group__timer__module.html#g0155e5192956b3cd498751d8652f7773" title="Sets a general purpose timer.">macSetAlarm</a>(250,<a class="code" href="group__app.html#g2dbe1cf2d8881afe92c984d67cbf8656" title="Print prompts for debug mode.">printPrompt</a>);
<a name="l01225"></a>01225             }
<a name="l01226"></a>01226         }
<a name="l01227"></a>01227     }
<a name="l01228"></a>01228 
<a name="l01229"></a>01229     <span class="comment">// Process serial port interface with raven 3290P processor</span>
<a name="l01230"></a>01230     <span class="keywordflow">if</span> (!<a class="code" href="group__app.html#gd72dbcf6d0153db1b8d8a58001feed83" title="The global debugging flag.">DEBUG</a> &amp;&amp; <a class="code" href="group__serial.html#gae3f0b4211ba45d265973d40ccbb5fd1" title="Flag to enable the serial port.">SERIAL</a> &amp;&amp; <a class="code" href="group__radio.html#g1fa4f1561216be34f745f32aaa38d943" title="Defines the platform for which we are building the firmware.">PLATFORM</a> == <a class="code" href="group__radio.html#g462055ac8fe135ee319e31370d301016" title="Raven demo board (with LCD display).">RAVEN</a>)
<a name="l01231"></a>01231         <span class="keywordflow">if</span> (<a class="code" href="group__serial.html#gc4e9c77fea48d38fdffb2b9c3291ca8e" title="This will receive a frame from the ATmega3290p and parse the incoming data.">serial_rcv_frame</a>())
<a name="l01232"></a>01232         {
<a name="l01233"></a>01233             u8 *p;
<a name="l01234"></a>01234             <span class="keyword">static</span> u8 seq;
<a name="l01235"></a>01235 
<a name="l01236"></a>01236             <span class="comment">// Got a frame, process it</span>
<a name="l01237"></a>01237             <span class="keywordflow">switch</span> (SerialFrame-&gt;cmd)
<a name="l01238"></a>01238             {
<a name="l01239"></a>01239             <span class="keywordflow">case</span> CMD_PING_COORD:
<a name="l01240"></a>01240                 <span class="comment">// Send a ping packet to coordinator</span>
<a name="l01241"></a>01241                 <a class="code" href="group__mac__data.html#g7e4c5d07ec7a2622dabbcf51b1fe4ba9" title="Send a ping packet (either request or response) to another node.">macPing</a>(<a class="code" href="group__mac.html#g85ba6c45557eb0369e606452f9d902e6" title="Ping request frame.">PING_REQ_FRAME</a>, <a class="code" href="group__mac.html#gd24d249b0f426b8bd98a2180564531dc" title="The coordinator&amp;#39;s short address, always zero.">DEFAULT_COORD_ADDR</a>);
<a name="l01242"></a>01242                 <span class="keywordflow">break</span>;
<a name="l01243"></a>01243             <span class="keywordflow">case</span> CMD_PING_GOOGLE:
<a name="l01244"></a>01244                 <span class="keywordflow">if</span> (<a class="code" href="group__app.html#gfb4e3c89d60cf32cc974d72af22f5425" title="Enable or disable the IPV6/6LoWPAN layer by setting this macro to 1 (on) or 0 (off)...">IPV6LOWPAN</a>)
<a name="l01245"></a>01245                 {
<a name="l01246"></a>01246                     <span class="comment">// GOOGLE: 2001:4860:B006::68;</span>
<a name="l01247"></a>01247 
<a name="l01248"></a>01248                     <span class="comment">// Get pointer to IPv6 address buffer</span>
<a name="l01249"></a>01249                     p = <a class="code" href="group__avr6lowpan.html#g95782dbcd4ab7838c617ba6f224a2d88" title="Setup an ICMPv6 Echo Request packet for off-link IP addresses.">sixlowpan_hc01_ping_setup_ipglobal</a>(seq++);
<a name="l01250"></a>01250                     <span class="comment">// Put Google's address in the buffer</span>
<a name="l01251"></a>01251                     memcpy(p, <a class="code" href="group__avr6lowpan__example.html#gf89d4fb3cf6fbe62a1345ed6e8b07030" title="Store destination address of server.">googleipAddr</a>, 16);
<a name="l01252"></a>01252                     <span class="comment">// Now ping Google</span>
<a name="l01253"></a>01253                     <a class="code" href="group__avr6lowpan.html#g5ce700a614ec9bb34ddb0e23f77e80ed" title="Send a Ping Packet.">sixlowpan_hc01_ping_send</a>();
<a name="l01254"></a>01254                 }
<a name="l01255"></a>01255                 <span class="keywordflow">break</span>;
<a name="l01256"></a>01256             <span class="keywordflow">case</span> CMD_PING_SERVER:
<a name="l01257"></a>01257                 <span class="keywordflow">if</span> (<a class="code" href="group__app.html#gfb4e3c89d60cf32cc974d72af22f5425" title="Enable or disable the IPV6/6LoWPAN layer by setting this macro to 1 (on) or 0 (off)...">IPV6LOWPAN</a> )
<a name="l01258"></a>01258                 {
<a name="l01259"></a>01259                     <span class="comment">// Get pointer to IPv6 address buffer</span>
<a name="l01260"></a>01260                     p = <a class="code" href="group__avr6lowpan.html#g95782dbcd4ab7838c617ba6f224a2d88" title="Setup an ICMPv6 Echo Request packet for off-link IP addresses.">sixlowpan_hc01_ping_setup_ipglobal</a>(seq++);
<a name="l01261"></a>01261                     <span class="comment">// Put IPSO server's address in the buffer</span>
<a name="l01262"></a>01262                     memcpy(p, serveripAddr, 16);
<a name="l01263"></a>01263                     <span class="comment">// Now ping Google</span>
<a name="l01264"></a>01264                     <a class="code" href="group__avr6lowpan.html#g5ce700a614ec9bb34ddb0e23f77e80ed" title="Send a Ping Packet.">sixlowpan_hc01_ping_send</a>();
<a name="l01265"></a>01265                 }
<a name="l01266"></a>01266                 <span class="keywordflow">break</span>;
<a name="l01267"></a>01267             <span class="keywordflow">case</span> CMD_PING_NODE:
<a name="l01268"></a>01268                 <span class="keywordflow">if</span> (<a class="code" href="group__app.html#gfb4e3c89d60cf32cc974d72af22f5425" title="Enable or disable the IPV6/6LoWPAN layer by setting this macro to 1 (on) or 0 (off)...">IPV6LOWPAN</a> &amp;&amp; APP == IPSO)
<a name="l01269"></a>01269                 {
<a name="l01270"></a>01270                     <span class="comment">// Get pointer to IPv6 address buffer</span>
<a name="l01271"></a>01271                     p = <a class="code" href="group__avr6lowpan.html#g95782dbcd4ab7838c617ba6f224a2d88" title="Setup an ICMPv6 Echo Request packet for off-link IP addresses.">sixlowpan_hc01_ping_setup_ipglobal</a>(seq++);
<a name="l01272"></a>01272                     <span class="comment">// Put other end node's address in the buffer</span>
<a name="l01273"></a>01273                     memcpy(p, <a class="code" href="group__avr6lowpan__example.html#ga1f8400d1913a42745c2530995f30f8d" title="Store destination address of commands.">destipAddr</a>, 16);
<a name="l01274"></a>01274                     <span class="comment">// Now ping Google</span>
<a name="l01275"></a>01275                     <a class="code" href="group__avr6lowpan.html#g5ce700a614ec9bb34ddb0e23f77e80ed" title="Send a Ping Packet.">sixlowpan_hc01_ping_send</a>();
<a name="l01276"></a>01276                 }
<a name="l01277"></a>01277                 <span class="keywordflow">break</span>;
<a name="l01278"></a>01278             <span class="keywordflow">case</span> CMD_LED:
<a name="l01279"></a>01279                 <span class="comment">// Turn on remote LED</span>
<a name="l01280"></a>01280                 <span class="keywordflow">if</span> (<a class="code" href="group__app.html#gfb4e3c89d60cf32cc974d72af22f5425" title="Enable or disable the IPV6/6LoWPAN layer by setting this macro to 1 (on) or 0 (off)...">IPV6LOWPAN</a> &amp;&amp; APP == IPSO)
<a name="l01281"></a>01281                 {
<a name="l01282"></a>01282                     <span class="comment">// Get pointer to IPv6 address buffer</span>
<a name="l01283"></a>01283                     p = <a class="code" href="group__avr6lowpan.html#g805964e13e701bdde2a4058f8a44ce50" title="Setup a UDP packet for off-link IP addresses.">sixlowpan_hc01_udp_setup_ipglobal</a>();
<a name="l01284"></a>01284                     <span class="comment">// Put other end node's address in the buffer</span>
<a name="l01285"></a>01285                     memcpy(p, <a class="code" href="group__avr6lowpan__example.html#ga1f8400d1913a42745c2530995f30f8d" title="Store destination address of commands.">destipAddr</a>, 16);
<a name="l01286"></a>01286 
<a name="l01287"></a>01287                     <span class="comment">// Setup ports</span>
<a name="l01288"></a>01288                     <a class="code" href="group__avr6lowpan.html#geda0cc06167d50c3dfc43eb8699548e0" title="Setup a UDP packet&amp;#39;s port information.">sixlowpan_hc01_udp_setup_ports</a>(UDP_PORT_RESPONSE, UDP_PORT_COMMANDS);
<a name="l01289"></a>01289                     memcpy( <a class="code" href="group__avr6lowpan.html#g270d58c0390fa3a648de3d2df7a179b4" title="Get a pointer to the payload section of the UDP packet.">sixlowpan_hc01_udp_get_payloadptr</a>(),
<a name="l01290"></a>01290                             (seq++ &amp; 1) ? <span class="stringliteral">"A1"</span>: <span class="stringliteral">"A0"</span> ,2);
<a name="l01291"></a>01291                     <a class="code" href="group__avr6lowpan.html#g5aee4b0d2faa99889dde62f995f156ec" title="Set amount of data user has loaded into payload section.">sixlowpan_hc01_udp_set_payloadsize</a>(2);
<a name="l01292"></a>01292                     <a class="code" href="group__avr6lowpan.html#gf25c7b0fc910cfbee13b71a0129e7f3c" title="Send a UDP Packet.">sixlowpan_hc01_udp_send</a>();
<a name="l01293"></a>01293                 }
<a name="l01294"></a>01294                 <span class="keywordflow">break</span>;
<a name="l01295"></a>01295             <span class="keywordflow">default</span>:
<a name="l01296"></a>01296                 <span class="keywordflow">break</span>;
<a name="l01297"></a>01297             }
<a name="l01298"></a>01298         }
<a name="l01299"></a>01299 }
<a name="l01300"></a>01300 <span class="preprocessor">#endif</span>
<a name="l01301"></a>01301 <span class="preprocessor"></span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jun 8 18:38:19 2009 for RUM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
