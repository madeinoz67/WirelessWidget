<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>RUM: rum_src/sensors.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>rum_src/sensors.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Copyright (c) 2008  ATMEL Corporation</span>
<a name="l00002"></a>00002 <span class="comment">   All rights reserved.</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">   Redistribution and use in source and binary forms, with or without</span>
<a name="l00005"></a>00005 <span class="comment">   modification, are permitted provided that the following conditions are met:</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">   * Redistributions of source code must retain the above copyright</span>
<a name="l00008"></a>00008 <span class="comment">     notice, this list of conditions and the following disclaimer.</span>
<a name="l00009"></a>00009 <span class="comment">   * Redistributions in binary form must reproduce the above copyright</span>
<a name="l00010"></a>00010 <span class="comment">     notice, this list of conditions and the following disclaimer in</span>
<a name="l00011"></a>00011 <span class="comment">     the documentation and/or other materials provided with the</span>
<a name="l00012"></a>00012 <span class="comment">     distribution.</span>
<a name="l00013"></a>00013 <span class="comment">   * Neither the name of the copyright holders nor the names of</span>
<a name="l00014"></a>00014 <span class="comment">     contributors may be used to endorse or promote products derived</span>
<a name="l00015"></a>00015 <span class="comment">     from this software without specific prior written permission.</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"</span>
<a name="l00018"></a>00018 <span class="comment">  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="l00019"></a>00019 <span class="comment">  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="l00020"></a>00020 <span class="comment">  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
<a name="l00021"></a>00021 <span class="comment">  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<a name="l00022"></a>00022 <span class="comment">  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<a name="l00023"></a>00023 <span class="comment">  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<a name="l00024"></a>00024 <span class="comment">  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<a name="l00025"></a>00025 <span class="comment">  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<a name="l00026"></a>00026 <span class="comment">  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<a name="l00027"></a>00027 <span class="comment">  POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00028"></a>00028 <span class="comment">*/</span>
<a name="l00029"></a>00029 <span class="comment">/*</span>
<a name="l00030"></a>00030 <span class="comment">  $Id: sensors.h,v 1.1 2009/05/20 20:52:01 mvidales Exp $</span>
<a name="l00031"></a>00031 <span class="comment">*/</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#ifndef SENSORS_H</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#define SENSORS_H</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>
<a name="l00036"></a>00036 <span class="preprocessor">#include "mac.h"</span>
<a name="l00037"></a>00037 
<a name="l00044"></a><a class="code" href="group__sensors.html#g0db34a0a32664c41baf8a411f94af692">00044</a> <span class="preprocessor">#define SENSOR_RANDOM_T  1  </span>
<a name="l00045"></a><a class="code" href="group__sensors.html#gaacf427b057e083e3e587487fb616ef6">00045</a> <span class="preprocessor">#define SENSOR_RANDOM_H  2  </span>
<a name="l00046"></a><a class="code" href="group__sensors.html#gb97b22899011d3109857adf5da5ee853">00046</a> <span class="preprocessor">#define SENSOR_THERMIST  3  </span>
<a name="l00047"></a><a class="code" href="group__sensors.html#g2164e5262df2b20e15e1a91d6ec02199">00047</a> <span class="preprocessor">#define SENSOR_TMP275    4  </span>
<a name="l00048"></a><a class="code" href="group__sensors.html#g7efdcb7e253d5d20d7b363187fbac5fb">00048</a> <span class="preprocessor">#define SENSOR_NET       5  </span>
<a name="l00049"></a><a class="code" href="group__sensors.html#ge82bc89269f3ed43b599beb9b4c1e9da">00049</a> <span class="preprocessor">#define SENSOR_DSK_ACEL  6  </span>
<a name="l00050"></a><a class="code" href="group__sensors.html#g41697efb33aa9689544655352258fb9c">00050</a> <span class="preprocessor">#define SENSOR_DSK_TEMP  7  </span>
<a name="l00051"></a>00051 <span class="preprocessor"></span>
<a name="l00054"></a>00054 <span class="preprocessor">#ifndef SENSOR_TYPE</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span>
<a name="l00060"></a><a class="code" href="group__sensors.html#g56d52d2738e5c93e3360a339438082cf">00060</a> <span class="preprocessor">#define SENSOR_TYPE       SENSOR_RANDOM_H  // Default is random data for demo.</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>
<a name="l00063"></a>00063 <span class="comment">// Make sure ADC is off unless we need it</span>
<a name="l00064"></a>00064 <span class="preprocessor">#if SENSOR_TYPE == SENSOR_THERMIST || \</span>
<a name="l00065"></a>00065 <span class="preprocessor">    SENSOR_TYPE == SENSOR_DSK_TEMP || \</span>
<a name="l00066"></a>00066 <span class="preprocessor">    SENSOR_TYPE == SENSOR_DSK_ACEL</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#define ADC_ENABLED 1</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#define ADC_ENABLED 0</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>
<a name="l00087"></a><a class="code" href="group__sensors.html#gf043ffbaded29195355d60ecedaefc1e">00087</a> <span class="preprocessor">#define SET_NODE_NAME          2   </span>
<a name="l00088"></a><a class="code" href="group__sensors.html#g39dad5365f757af1ab4df17205094824">00088</a> <span class="preprocessor">#define REQ_READING_FRAME      3   </span>
<a name="l00089"></a><a class="code" href="group__sensors.html#g57f3ac36ac51b7d968a434bdb8a3c962">00089</a> <span class="preprocessor">#define READING_FRAME          4   </span>
<a name="l00090"></a><a class="code" href="group__sensors.html#g1af9df1e7fdcaf557f95d5d22e5320b9">00090</a> <span class="preprocessor">#define CAL_REQ_INFO_FRAME     5   </span>
<a name="l00091"></a><a class="code" href="group__sensors.html#gf61540ef7a529a49a59b35bb0ed504c4">00091</a> <span class="preprocessor">#define CAL_INFO_FRAME         6   </span>
<a name="l00092"></a><a class="code" href="group__sensors.html#gfcd0ac780c55f3688b1558be01eb7171">00092</a> <span class="preprocessor">#define REQ_RAW_DATA_FRAME     7   </span>
<a name="l00093"></a><a class="code" href="group__sensors.html#g3a1beefd72052f2815d7cf10b229d5f4">00093</a> <span class="preprocessor">#define RAW_DATA_FRAME         8   </span>
<a name="l00094"></a><a class="code" href="group__sensors.html#g3f545c09e20bfb392502eb3808272f98">00094</a> <span class="preprocessor">#define CAL_CMD_FRAME          9   </span>
<a name="l00095"></a>00095 <span class="preprocessor"></span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>
<a name="l00098"></a><a class="code" href="group__sensors.html#gf71324c57f05ff9e24bd384925dd6b17">00098</a> <span class="preprocessor">#define NAME_LENGTH 8</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span>
<a name="l00101"></a><a class="code" href="group__sensors.html#gaae5f0c0221a794b41194ff6eede970b">00101</a> <span class="preprocessor">#define REPORT_ALL    2</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>
<a name="l00103"></a>00103 <span class="comment">// Support for pining all nodes.</span>
<a name="l00104"></a>00104 <span class="preprocessor">#define PING_ALL      1</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span>
<a name="l00109"></a><a class="code" href="structsftSensorReading.html">00109</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>{
<a name="l00110"></a><a class="code" href="structsftSensorReading.html#141d6c6f80efc6afdbac6370337d9bb8">00110</a>     u8    type;          
<a name="l00111"></a><a class="code" href="structsftSensorReading.html#419fdd9519cfd9f255f651c7c13b429c">00111</a>     u16   addr;          
<a name="l00112"></a><a class="code" href="structsftSensorReading.html#6af0b41f38cd5f98a3a70676475cc0ba">00112</a>     u8    reading[6];    
<a name="l00113"></a><a class="code" href="structsftSensorReading.html#ac5a59b80df839161a69a7dd341d290b">00113</a>     u8    units[5];      
<a name="l00114"></a><a class="code" href="structsftSensorReading.html#de3ea62dbae1b37c042d391ff49eb7c2">00114</a>     <span class="keywordtype">char</span>  name[<a class="code" href="group__sensors.html#gf71324c57f05ff9e24bd384925dd6b17" title="Length of node name string.">NAME_LENGTH</a>];  
<a name="l00115"></a>00115 } __attribute__((packed)) <a class="code" href="structsftSensorReading.html" title="Sensor reading packet, sent by sensor node to report its data to the coordinator...">sftSensorReading</a>;
<a name="l00116"></a>00116 
<a name="l00120"></a><a class="code" href="structsftRequest.html">00120</a> typedef struct{
<a name="l00121"></a><a class="code" href="structsftRequest.html#8d57860dee8b2f8275a33c27053ce711">00121</a>     u8    type;          
<a name="l00122"></a>00122 } __attribute__((packed)) <a class="code" href="structsftRequest.html" title="Sensor calibration request packet, sent by coordinator to ask sensor node to reply...">sftRequest</a>;
<a name="l00123"></a>00123 
<a name="l00127"></a><a class="code" href="structsftRequestData.html">00127</a> typedef struct{
<a name="l00128"></a><a class="code" href="structsftRequestData.html#a4a2afd21bcbf64b9c3f42e47800b434">00128</a>     u8    type;          
<a name="l00129"></a><a class="code" href="structsftRequestData.html#d295186fbd1e08db7d44035817b34903">00129</a>     u16   time;          
<a name="l00130"></a>00130 } __attribute__((packed)) <a class="code" href="structsftRequestData.html" title="Sensor data request packet, sent by coordinator to ask sensor node to reply with...">sftRequestData</a>;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 
<a name="l00136"></a><a class="code" href="structsftCalInfo.html">00136</a> typedef struct{
<a name="l00137"></a><a class="code" href="structsftCalInfo.html#5d998255cba79307c5afa930e37f9f12">00137</a>     u8    type;          
<a name="l00138"></a><a class="code" href="structsftCalInfo.html#7fb5c56a7ea6fb1ab552145d556b76cf">00138</a>     u8    calType;       
<a name="l00139"></a><a class="code" href="structsftCalInfo.html#d3f6a51354df1cd2cf0f50ad1a08579f">00139</a>     u16   addr;          
<a name="l00140"></a><a class="code" href="structsftCalInfo.html#b1226be47c0b6d3eee51354e4144dc51">00140</a>     u8    units[5];      
<a name="l00141"></a>00141 } __attribute__((packed)) <a class="code" href="structsftCalInfo.html" title="Sensor calibration info packet, sent by sensor node to report its data to the coordinator...">sftCalInfo</a>;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 extern sftCalInfo coordCalInfo[(<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a> == <a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)];
<a name="l00144"></a>00144 
<a name="l00146"></a><a class="code" href="structsftSetName.html">00146</a> typedef struct{
<a name="l00147"></a><a class="code" href="structsftSetName.html#77ec5a5276ee6117e2fee83d5ebe9d83">00147</a>     u8    type;          
<a name="l00148"></a><a class="code" href="structsftSetName.html#628ed6d81ba689a60793b0b822a87d1f">00148</a>     <span class="keywordtype">char</span>  name[<a class="code" href="group__sensors.html#gf71324c57f05ff9e24bd384925dd6b17" title="Length of node name string.">NAME_LENGTH</a>]; 
<a name="l00149"></a>00149 } __attribute__((packed)) <a class="code" href="structsftSetName.html" title="Change name of node packet, sent to sensor node.">sftSetName</a>;
<a name="l00150"></a>00150 
<a name="l00153"></a><a class="code" href="structsftRawData.html">00153</a> typedef struct{
<a name="l00154"></a><a class="code" href="structsftRawData.html#e59e0a1958cd93587a0dc474606d150d">00154</a>     u8    type;          
<a name="l00155"></a><a class="code" href="structsftRawData.html#7c10a8139073a9ab7e7ebbb0b2d7ba42">00155</a>     u16   reading;       
<a name="l00156"></a>00156 } __attribute__((packed)) <a class="code" href="structsftRawData.html" title="Raw data (A/D reading) from a sensor node.">sftRawData</a>;
<a name="l00157"></a>00157 
<a name="l00162"></a><a class="code" href="structsftCalCommand.html">00162</a> typedef struct{
<a name="l00163"></a><a class="code" href="structsftCalCommand.html#dd4f5ebab22c4b53209d719c7ceac8c1">00163</a>     u8    type;           
<a name="l00164"></a><a class="code" href="structsftCalCommand.html#c9fd11c9d74b8e4bdc095bffb798c8df">00164</a>     u8    index;          
<a name="l00165"></a><a class="code" href="structsftCalCommand.html#658e1e72765eaa873eeda5edfb816e0f">00165</a>     u8    reading[8];     
<a name="l00166"></a>00166 } __attribute__((packed)) <a class="code" href="structsftCalCommand.html" title="Calibration command frame, sent from the coordinator to a end/router node, commanding...">sftCalCommand</a>;
<a name="l00167"></a>00167 
<a name="l00176"></a><a class="code" href="structtCalFactors.html">00176</a> typedef struct{
<a name="l00177"></a><a class="code" href="structtCalFactors.html#29a37960efc2553cecb299d577e9f9e8">00177</a>     <span class="keywordtype">double</span> m;     
<a name="l00178"></a><a class="code" href="structtCalFactors.html#572fff4e21155103b0e2cda10512a81a">00178</a>     <span class="keywordtype">double</span> b;     
<a name="l00179"></a>00179 } __attribute__((packed)) <a class="code" href="structtCalFactors.html" title="Calibration data, stored in EEPROM.">tCalFactors</a>;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 <span class="keywordtype">void</span> <a class="code" href="group__app.html#g294a39a42680ce725580f509c3ab692e" title="When called, this will either Ping or request data from all associated nodes.">allNodes</a>(u8 func, u16 val);
<a name="l00183"></a>00183 extern u16 node_addr;
<a name="l00184"></a>00184 extern <span class="keywordtype">char</span> node_name[<a class="code" href="group__sensors.html#gf71324c57f05ff9e24bd384925dd6b17" title="Length of node name string.">NAME_LENGTH</a>*(<a class="code" href="group__mac.html#g59569ff056c7f0f124222ca0013728d5" title="NODETYPE is defined to be one of the three basic node types: coordinator, router...">NODETYPE</a>==<a class="code" href="group__mac.html#g146ff2075038ea93bc2d81bba8df519e" title="Coordinator node.">COORD</a>)];
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 <span class="keywordtype">void</span> <a class="code" href="group__sensors.html#ge0815bb7fb90effa997f450cedc67ec4" title="Initialize the sensor system by configuring the A/D converter.">sensorInit</a>(<span class="keywordtype">void</span>);
<a name="l00187"></a>00187 <span class="keywordtype">void</span> <a class="code" href="group__sensors.html#gcab00d2731b419ed4dbf8e29e57a712a" title="Begin auto-sending data after powerup.">sensorAutoSendStart</a>(<span class="keywordtype">void</span>);
<a name="l00188"></a>00188 <span class="keywordtype">void</span> <a class="code" href="group__sensors.html#gbaa8d61c91f652d5e95e2ec6c9f00b4d" title="Handle a received packet.">sensorRcvPacket</a>(u8 *frame);
<a name="l00189"></a>00189 <span class="keywordtype">void</span> <a class="code" href="group__sensors.html#g32bb0a72bd1635959ac4397db317edae" title="Request a reading from a sensor node.">sensorRequestReading</a>(u16 addr, u16 time);
<a name="l00190"></a>00190 <span class="keywordtype">void</span> <a class="code" href="group__sensors.html#g7be640146ea956f71c4540c1b247567c" title="Request an end node to send its calibration information.">sensorRequestCalInfo</a>(u16 addr);
<a name="l00191"></a>00191 <span class="keywordtype">void</span> sensorRequestRawData(u16 addr);
<a name="l00192"></a>00192 <span class="keywordtype">void</span> <a class="code" href="group__sensors.html#g0717b6140ef26cb1daa46ac31113f034" title="Set the name of the sensor name.">sensorSendSetNodeName</a>(u16 addr, <span class="keywordtype">char</span> *name);
<a name="l00193"></a>00193 <span class="keywordtype">void</span> sensorSendCalPoint(u8 index, <span class="keywordtype">char</span> *str);
<a name="l00194"></a>00194 u8 <a class="code" href="group__sensors.html#g38d09386a3cbf1fa2e8296db204f1fdb" title="Returns true if the node is engaged in a calibration process.">sensorCalBusy</a>(<span class="keywordtype">void</span>);
<a name="l00195"></a>00195 <span class="keywordtype">char</span> *<a class="code" href="group__sensors.html#g4320310b6bca7d1d72e8e3abc56bc348" title="Returns a pointer to the name of this node.">sensorGetName</a>(<span class="keywordtype">void</span>);
<a name="l00196"></a>00196 <span class="keywordtype">void</span> <a class="code" href="group__sensors.html#g0717b6140ef26cb1daa46ac31113f034" title="Set the name of the sensor name.">sensorSendSetNodeName</a>(u16 addr, <span class="keywordtype">char</span> *name);
<a name="l00197"></a>00197 <span class="keywordtype">void</span> <a class="code" href="group__sensors.html#gc19b9d07f0d5fbd26244c134f727a6a5" title="This node has successfully sent a packet, and this function is called when that happens...">sensorPacketSendSucceed</a>(<span class="keywordtype">void</span>);
<a name="l00198"></a>00198 <span class="keywordtype">void</span> <a class="code" href="group__sensors.html#g1e9d45b57b1e75c02f3f03ea08116bd8" title="This node has failed to send a packet.">sensorPacketSendFailed</a>(<span class="keywordtype">void</span>);
<a name="l00199"></a>00199 <span class="keywordtype">void</span> <a class="code" href="group__sensors.html#gd9a0ce8079a3c9aeb57f592608a4fd2d" title="This node has lost its network connection.">sensorLostNetwork</a>(<span class="keywordtype">void</span>);
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="keywordtype">void</span> <a class="code" href="group__avr6lowpan__example.html#ge148b7a530a32b86d057b5cf6e76427b" title="Called to send a UDP packet to the periodic address.">sixlowpan_sensorPerSend</a>(u8 len, u8 * data);
<a name="l00202"></a>00202 <span class="keywordtype">void</span> <a class="code" href="group__avr6lowpan__example.html#g791305218d50b24b349f438a400c4826" title="Called to send a UDP packet to a specific end-node.">sixlowpan_sensorSend</a>(u16 addr, u8 len, u8 * data);
<a name="l00203"></a>00203 <span class="keywordtype">void</span> <a class="code" href="group__avr6lowpan__example.html#g71646ae68963dafaac0092b91eb68604" title="Called to send back a UDP packet to the source.">sixlowpan_sensorReturn</a>(u8 len, u8 * data);
<a name="l00204"></a>00204 <span class="keywordtype">void</span> <a class="code" href="group__sensors.html#gc4fd19ca8f3d53a6d64bc4869713acbb" title="Send a single reading to the coordinator and go to sleep if required.">sendReading</a>(<span class="keywordtype">void</span>);
<a name="l00205"></a>00205 
<a name="l00208"></a>00208 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jun 8 18:38:19 2009 for RUM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
